"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[8352],{8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(6540);const i={},d=s.createContext(i);function o(e){const r=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(d.Provider,{value:r},e.children)}},8505:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"ExpressJS/Express/RetroGamesDB/WlasneMiddleware","title":"Tworzymy `middleware`y","description":"Dalej pracujemy z aplikacj\u0105 RetroGamesDB.","source":"@site/docs/3. ExpressJS/50.Express/20.RetroGamesDB/93.WlasneMiddleware.mdx","sourceDirName":"3. ExpressJS/50.Express/20.RetroGamesDB","slug":"/ExpressJS/Express/RetroGamesDB/WlasneMiddleware","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/WlasneMiddleware","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3. ExpressJS/50.Express/20.RetroGamesDB/93.WlasneMiddleware.mdx","tags":[],"version":"current","sidebarPosition":93,"frontMatter":{"title":"Tworzymy `middleware`y"},"sidebar":"tutorialSidebar","previous":{"title":"Routes","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/Routes"},"next":{"title":"CRUD z JSON","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/DaneWJSON"}}');var i=n(4848),d=n(8453);const o={title:"Tworzymy `middleware`y"},a="Tworzymy middlewarey",t={},l=[{value:"Prosty logger",id:"prosty-logger",level:2},{value:"<code>GameValidator</code>",id:"gamevalidator",level:2},{value:"<code>QueryDebugger</code>",id:"querydebugger",level:2}];function c(e){const r={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsxs)(r.h1,{id:"tworzymy-middlewarey",children:["Tworzymy ",(0,i.jsx)(r.code,{children:"middleware"}),"y"]})}),"\n",(0,i.jsxs)(r.p,{children:["Dalej pracujemy z aplikacj\u0105 ",(0,i.jsx)(r.em,{children:"RetroGamesDB"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Utworzymy trzy ",(0,i.jsx)(r.code,{children:"middleware"}),"'y:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"prosty logger"}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:"GameValidator"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:"QueryDebugger"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"prosty-logger",children:"Prosty logger"}),"\n",(0,i.jsxs)(r.p,{children:["Do pliku ",(0,i.jsx)(r.code,{children:"app.ts"})," dodajemy:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'app.use(express.json());\n\n// prosty logger\napp.use((req,res,next) =>{\n    console.log(`Path: ${req.path}, Method: ${req.method}`)\n    next()\n})\n\napp.use("/games", gamesRouter)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"gamevalidator",children:(0,i.jsx)(r.code,{children:"GameValidator"})}),"\n",(0,i.jsxs)(r.admonition,{type:"tip",children:[(0,i.jsxs)(r.mdxAdmonitionTitle,{children:['Gdzie "trzyma\u0107" ',(0,i.jsx)(r.em,{children:"middleware"}),"'y w projekcie?"]}),(0,i.jsxs)(r.p,{children:["Funkcje ",(0,i.jsx)(r.em,{children:"middleware"})," powinny by\u0107:"]}),(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"trzymane w oddzielnym pliku,"}),"\n",(0,i.jsxs)(r.li,{children:["w folderze ",(0,i.jsx)(r.code,{children:"middlewares"}),"."]}),"\n"]})]}),"\n",(0,i.jsxs)(r.p,{children:["Utw\xf3rzmy folder ",(0,i.jsx)(r.code,{children:"middlewares"})," w ",(0,i.jsx)(r.code,{children:"src"}),", a w nim plik ",(0,i.jsx)(r.code,{children:"GameValidator.ts"}),"."]}),"\n",(0,i.jsx)(r.p,{children:"Nasz *middleware` b\u0119dzie:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["sprawdza\u0142, czy w ",(0,i.jsx)(r.code,{children:"body"})," znajduj\u0105 si\u0119 wszystkie kluczowe pola gry."]}),"\n",(0,i.jsx)(r.li,{children:"zwraca\u0142 czytelny komunikat b\u0142\u0119du, je\u015bli czego\u015b brakuje."}),"\n",(0,i.jsxs)(r.li,{children:["chroni\u0142 ",(0,i.jsx)(r.em,{children:"backend"})," przed \u201e\u015bmieciowymi\u201d ",(0,i.jsx)(r.code,{children:"request"}),"ami."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Przypomnijmy sobie model gry:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"interface Game {\n    id: number;\n    title: string;\n    year: number;\n    platform: string;\n    genre: string;\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Je\u017celi w ",(0,i.jsx)(r.code,{children:"request"})," b\u0119dzie brakowa\u0142o kt\xf3rego\u015b z tych p\xf3l,\n",(0,i.jsx)(r.code,{children:"GameValidator"})," zatrzyma pr\xf3b\u0119 dodania nowej gry."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.code,{children:"GameValidator.kt"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'import { Request, Response, NextFunction } from "express";\n\nexport function validateGame(req: Request, res: Response, next: NextFunction) {\n    if (![\'POST\', \'PUT\'].includes(req.method)) return next();\n\n    const { title, year, platform, genre } = req.body;\n    const errors: string[] = [];\n\n    if (!title) errors.push("title is required");\n    if (!year) errors.push("year is required");\n    if (!platform) errors.push("platform is required");\n    if (!genre) errors.push("genre is required");\n\n    if (year !== undefined && (typeof year !== \'number\' || !Number.isInteger(year))) {\n        errors.push("year must be an integer");\n    }\n\n    if (errors.length > 0) {\n        return res.status(400).json({ errors });\n    }\n\n    next();\n}\n\n'})}),"\n",(0,i.jsxs)(r.p,{children:["U\u017cyjemy naszej funkcji w ",(0,i.jsx)(r.code,{children:"app.ts"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"app.use(express.json());\napp.use(validateGame);\n\n"})}),"\n",(0,i.jsxs)(r.admonition,{title:"Pami\u0119taj",type:"tip",children:[(0,i.jsxs)(r.p,{children:["Walidator u\u017cyty przez routerem!\nExpress przetwarza ",(0,i.jsx)(r.code,{children:"middleware"}),"y (i ",(0,i.jsx)(r.code,{children:"router"}),"y) w takiej kolejno\u015bci, w jakiej je doda\u0142e\u015b.\nJe\u017celi walidator b\u0119dzie u\u017cyty po routerze, to nigdy si\u0119 nie wykona."]}),(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'app.use(validateGame)\napp.use("/games", gamesRouter)\n'})})]}),"\n",(0,i.jsx)(r.h2,{id:"querydebugger",children:(0,i.jsx)(r.code,{children:"QueryDebugger"})}),"\n",(0,i.jsxs)(r.p,{children:["Zadaniem tego ",(0,i.jsx)(r.code,{children:"middleware"}),"a b\u0119dzie wypisywanie w konsoli\nwszystkich u\u017cytych ",(0,i.jsx)(r.em,{children:"query paramy"})," (np. ",(0,i.jsx)(r.code,{children:"?platform=ps2&year=2000"}),")."]}),"\n",(0,i.jsxs)(r.p,{children:["W folderze ",(0,i.jsx)(r.code,{children:"middlewares"})," tworzymy plik ",(0,i.jsx)(r.code,{children:"QueryDebugger.ts"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"import { Request, Response, NextFunction } from \"express\";\n\nexport function queryDebugger(req: Request, res: Response, next: NextFunction) {\n    if (req.method !== 'GET') return next();\n\n    const now = new Date().toISOString();\n    const { originalUrl, query } = req; //originalUrl = path + query string (wszystko po nazwie hosta)\n\n    console.log(`\\nQUERY DEBUG | ${now}`);\n    console.log(`GET ${originalUrl}`);\n\n    if (Object.keys(query).length === 0) {\n        console.log('(query pusty)');\n    } else {\n        console.table(query);\n    }\n    console.log('-'.repeat(60));\n\n    next();\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:["U\u017cyjemy naszej funkcji w pliku ",(0,i.jsx)(r.code,{children:"app.js"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'//..\napp.use(validateGame)\napp.use(queryDebugger)\napp.use("/games", gamesRouter)\n//..\n'})}),"\n",(0,i.jsxs)(r.p,{children:["Jednak te ",(0,i.jsx)(r.code,{children:"middleware"}),"y dotycz\u0105 wy\u0142\u0105cznie gier, wi\u0119c\npowinni\u015bmy napisa\u0107 ",(0,i.jsx)(r.code,{children:'app.use("/games", queryDebugger)'}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Skoro dotycz\u0105 tylko ",(0,i.jsx)(r.em,{children:"endpointu"})," ",(0,i.jsx)(r.code,{children:"/games"}),", to powinni\u015bmy je przenie\u015b\u0107 do pliku ",(0,i.jsx)(r.code,{children:"gamesRouter.ts"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Usu\u0144my je z ",(0,i.jsx)(r.code,{children:"app.ts"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Dopiszmy je w naszym ",(0,i.jsx)(r.code,{children:"gamesRouter.ts"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'//...\nimport {queryDebugger} from "../middlewares/QueryDebugger";\nimport {validateGame} from "../middlewares/GameValidator";\n\nconst router = Router();\n\n// middleware tylko dla gier\nrouter.use(queryDebugger);\nrouter.use(validateGame);\n\n//...\n'})})]})}function p(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);