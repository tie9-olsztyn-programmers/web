"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[8243],{3336:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>j,frontMatter:()=>c,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"MongoDB/Agregacja","title":"Agregacja","description":"Teoria","source":"@site/docs/4. MongoDB/60.Agregacja.mdx","sourceDirName":"4. MongoDB","slug":"/MongoDB/Agregacja","permalink":"/web/docs/MongoDB/Agregacja","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/4. MongoDB/60.Agregacja.mdx","tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"title":"Agregacja"},"sidebar":"tutorialSidebar","previous":{"title":"Projekcja","permalink":"/web/docs/MongoDB/ProjekcjaIFiltrowanie"},"next":{"title":"Wprowadzenie do MERN","permalink":"/web/docs/MERN - Fullstack/Intro MERN"}}');var a=i(4848),d=i(8453);const c={title:"Agregacja"},o="Agregacja",l={},t=[{value:"Teoria",id:"teoria",level:2},{value:"Definicja",id:"definicja",level:3},{value:"Struktura agregacji",id:"struktura-agregacji",level:3},{value:"Prosty przyk\u0142ad",id:"prosty-przyk\u0142ad",level:3},{value:"<code>find()</code> i <code>aggregate()</code>",id:"find-i-aggregate",level:3},{value:"Praktyka",id:"praktyka",level:2},{value:"Zapytania",id:"zapytania",level:3},{value:"Wybierzmy tylko warzywa",id:"wybierzmy-tylko-warzywa",level:4},{value:"Z warzyw wy\u015bwietlmy tylko nazw\u0119 i kaloryczno\u015b\u0107",id:"z-warzyw-wy\u015bwietlmy-tylko-nazw\u0119-i-kaloryczno\u015b\u0107",level:4},{value:"Grupujemy <code>$group</code> - ile produk\xf3w w danej kategorii",id:"grupujemy-group---ile-produk\xf3w-w-danej-kategorii",level:4},{value:"Zliczanie dokument\xf3w",id:"zliczanie-dokument\xf3w",level:2}];function s(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"agregacja",children:"Agregacja"})}),"\n",(0,a.jsx)(n.h2,{id:"teoria",children:"Teoria"}),"\n",(0,a.jsx)(n.h3,{id:"definicja",children:"Definicja"}),"\n",(0,a.jsxs)(n.admonition,{title:"Co to jest agregacja?",type:"info",children:[(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Agregacja to spos\xf3b przetwarzania danych w etapach (",(0,a.jsx)(n.em,{children:"pipeline"}),")."]}),"\n",(0,a.jsx)(n.li,{children:"Ka\u017cdy etap bierze dane z poprzedniego i zmienia je lub filtruje."}),"\n"]}),(0,a.jsx)(n.admonition,{title:"W MongoDB ka\u017cdy taki etap to operator zaczynaj\u0105cy si\u0119 od $:",type:"tip",children:(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$match"})," \u2013 wybiera dokumenty"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$project"})," \u2013 wybiera pola / tworzy nowe pola"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$group"})," \u2013 grupuje i liczy"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$sort"})," \u2013 sortuje"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$limit"})," \u2013 ogranicza wynik"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$count"})," \u2013 liczy dokumenty"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$lookup"})," \u2013 do\u0142\u0105cza dane z innej kolekcji (prawie jak JOIN)"]}),"\n"]})})]}),"\n",(0,a.jsx)(n.h3,{id:"struktura-agregacji",children:"Struktura agregacji"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"db.collection.aggregate([\n  { etap1 },\n  { etap2 },\n  { etap3 }\n])\n"})}),"\n",(0,a.jsx)(n.h3,{id:"prosty-przyk\u0142ad",children:"Prosty przyk\u0142ad"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"db.users.aggregate([\n  { $match: { age: { $gt: 18 } } },\n  { $project: { name: 1, age: 1 } }\n])\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$match"}),"      wybierz pe\u0142noletnich"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$project"}),"    poka\u017c tylko imi\u0119 i wiek"]}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{id:"find-i-aggregate",children:[(0,a.jsx)(n.code,{children:"find()"})," i ",(0,a.jsx)(n.code,{children:"aggregate()"})]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"find()"}),(0,a.jsx)(n.th,{children:"aggregate()"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Filtruje dokumenty"}),(0,a.jsx)(n.td,{children:"Filtruje i przetwarza dokumenty w etapach"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Poka\u017c wybrane pola"}),(0,a.jsx)(n.td,{children:"Tw\xf3rz nowe pola, zmieniaj struktur\u0119"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Tylko proste zapytania"}),(0,a.jsx)(n.td,{children:"Statystyki, grupowanie, sortowanie"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Nie robi JOIN"}),(0,a.jsxs)(n.td,{children:["Ma ",(0,a.jsx)(n.code,{children:"$lookup"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Bardzo proste"}),(0,a.jsx)(n.td,{children:"Bardzo pot\u0119\u017cne"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"praktyka",children:"Praktyka"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["tworzymy baz\u0119 ",(0,a.jsx)(n.code,{children:"use foodDB"})]}),"\n",(0,a.jsxs)(n.li,{children:["tworzymy kolekcj\u0119 ",(0,a.jsx)(n.code,{children:'db.createCollection("foods")'})]}),"\n",(0,a.jsxs)(n.li,{children:["wprowadzamy dane przez interfejs ",(0,a.jsx)(n.em,{children:"Compass"})," -> ",(0,a.jsx)(n.code,{children:"Documents"})," > ",(0,a.jsx)(n.code,{children:"+"}),":"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'/**\n* Paste one or more documents here\n*/\n[\n  { "name": "Apple",      "category": "fruit",  "calories": 52,  "vitamins": ["A", "C"] },\n  { "name": "Banana",     "category": "fruit",  "calories": 96,  "vitamins": ["B6", "C"] },\n  { "name": "Carrot",     "category": "vegetable", "calories": 41, "vitamins": ["A", "K"] },\n  { "name": "Broccoli",   "category": "vegetable", "calories": 55, "vitamins": ["C", "K"] },\n  { "name": "Chicken",    "category": "meat",   "calories": 239, "vitamins": ["B6"] }\n]\n'})}),"\n",(0,a.jsx)(n.h3,{id:"zapytania",children:"Zapytania"}),"\n",(0,a.jsx)(n.h4,{id:"wybierzmy-tylko-warzywa",children:"Wybierzmy tylko warzywa"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'db.foods.aggregate([\n  {$match: { category: "vegetable"}}\n])\n'})}),"\n",(0,a.jsx)(n.h4,{id:"z-warzyw-wy\u015bwietlmy-tylko-nazw\u0119-i-kaloryczno\u015b\u0107",children:"Z warzyw wy\u015bwietlmy tylko nazw\u0119 i kaloryczno\u015b\u0107"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'db.foods.aggregate([\n  {$match: { category: "vegetable"}},\n  {$project: {name: 1, calories: 1, _id:0}}\n])\n'})}),"\n",(0,a.jsxs)(n.p,{children:["To samo w ",(0,a.jsx)(n.em,{children:"Compass"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["wybieramy zak\u0142adk\u0119 ",(0,a.jsx)(n.code,{children:"Aggregations"}),":","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["tworzymy nowy ",(0,a.jsx)(n.code,{children:"stage"})," przez naci\u015bni\u0119cie przyciku ",(0,a.jsx)(n.code,{children:"Add stage"})]}),"\n",(0,a.jsxs)(n.li,{children:["w ",(0,a.jsx)(n.code,{children:"Stage 1 <Select> "})," wybieramy ",(0,a.jsx)(n.code,{children:"$match"})," i wpisujemy:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:'{category: "vegetable"}'})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["w ",(0,a.jsx)(n.code,{children:"Stage 2 <Select> "})," wybieramy ",(0,a.jsx)(n.code,{children:"$project"})," i wpisujemy:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"{ name:1, calories: 1, _id:0 }"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"grupujemy-group---ile-produk\xf3w-w-danej-kategorii",children:["Grupujemy ",(0,a.jsx)(n.code,{children:"$group"})," - ile produk\xf3w w danej kategorii"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'db.foods.aggregate([{\n $group: {\n  \t_id: "$category",\n    totalFoods: {$sum: 1}\n }\n}])\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"_id"}),"     pole, po kt\xf3rym grupujemy (tu: kategoria jedzenia)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$sum: 1"})," dodaj 1 dla ka\u017cdego dokumentu"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"zliczanie-dokument\xf3w",children:"Zliczanie dokument\xf3w"}),"\n",(0,a.jsxs)(n.p,{children:["Policzenie wszystkich:\n",(0,a.jsx)(n.code,{children:"db.users.countDocuments()"})]}),"\n",(0,a.jsxs)(n.p,{children:["Policzenie z filtrem:\n",(0,a.jsx)(n.code,{children:"db.users.countDocuments({ age: { $gt: 18 } })"})]})]})}function j(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(s,{...e})}):s(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>o});var r=i(6540);const a={},d=r.createContext(a);function c(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);