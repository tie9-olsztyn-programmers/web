"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[9182],{4560:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"ExpressJS/Express/RetroGamesDB/MiddleWare","title":"MiddleWare","description":"Definicja","source":"@site/docs/3. ExpressJS/50.Express/20.RetroGamesDB/30.MiddleWare.mdx","sourceDirName":"3. ExpressJS/50.Express/20.RetroGamesDB","slug":"/ExpressJS/Express/RetroGamesDB/MiddleWare","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/MiddleWare","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3. ExpressJS/50.Express/20.RetroGamesDB/30.MiddleWare.mdx","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"title":"MiddleWare"},"sidebar":"tutorialSidebar","previous":{"title":"Klient http w Webstorm","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/KlientHttpWWebstorm"},"next":{"title":"Dodajemy dane","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/DodajemyDane"}}');var d=s(4848),r=s(8453);const a={title:"MiddleWare"},o="Co to jest MiddleWare?",l={},t=[{value:"Definicja",id:"definicja",level:2},{value:"Metafory",id:"metafory",level:2},{value:"Syntaktyka Middleware`a",id:"syntaktyka-middlewarea",level:2},{value:"Przyk\u0142ad",id:"przyk\u0142ad",level:2},{value:"Middleware dla zapytania pod dowoln\u0105 \u015bcie\u017ck\u0105",id:"middleware-dla-zapytania-pod-dowoln\u0105-\u015bcie\u017ck\u0105",level:3},{value:"Middleware tylko dla \u015bcie\u017cek <code>/house</code>",id:"middleware-tylko-dla-\u015bcie\u017cek-house",level:3},{value:"`app.use(express.json())",id:"appuseexpressjson",level:2}];function c(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"co-to-jest-middleware",children:"Co to jest MiddleWare?"})}),"\n",(0,d.jsx)(n.h2,{id:"definicja",children:"Definicja"}),"\n",(0,d.jsxs)(n.admonition,{title:"Middleware",type:"info",children:[(0,d.jsx)(n.p,{children:"To po prostu funkcja po\u015brednicz\u0105c:"}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["czyli kawa\u0142ek kodu, kt\xf3ry przechwytuje ka\u017cde \u017c\u0105danie (",(0,d.jsx)(n.code,{children:"request"}),")"]}),"\n",(0,d.jsxs)(n.li,{children:["zanim trafi ono do w\u0142a\u015bciwego endpointu (",(0,d.jsx)(n.code,{children:"app.get"}),", ",(0,d.jsx)(n.code,{children:"app.post"})," itd.),"]}),"\n",(0,d.jsx)(n.li,{children:"lub przechwytuje odpowied\u017a (response) zanim opu\u015bci serwer."}),"\n"]}),(0,d.jsx)(n.p,{children:"Mo\u017cesz o nim my\u015ble\u0107 jako o filtrze lub etapie po drodze mi\u0119dzy klientem a serwerem."})]}),"\n",(0,d.jsx)(n.h2,{id:"metafory",children:"Metafory"}),"\n",(0,d.jsxs)(n.admonition,{title:"Middleware jako filtry w kawiarni",type:"tip",children:[(0,d.jsx)(n.p,{children:"Middleware dzia\u0142a jak filtry przy parzeniu kawy:"}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"gor\u0105ca woda (request) przechodzi przez filtr po filtrze (kolejne middleware\u2019y),"}),"\n",(0,d.jsx)(n.li,{children:"ka\u017cdy co\u015b zmienia (np. odfiltrowuje fusy, dodaje aromat, mleko, cukier),"}),"\n",(0,d.jsx)(n.li,{children:"efekt ko\u0144cowy to gotowy nap\xf3j (response)."}),"\n"]}),(0,d.jsx)(n.p,{children:"Je\u015bli kt\xf3ry\u015b filtr si\u0119 zatka \u2014 kawa nie dotrze do kubka \u2615\n(to jak brak next() \u2192 \u017c\u0105danie si\u0119 zatrzymuje)."})]}),"\n",(0,d.jsxs)(n.admonition,{title:"\ud83e\uddf3 Middleware \u2014 metafora lotniska",type:"tip",children:[(0,d.jsx)(n.p,{children:"Wyobra\u017a sobie, \u017ce:"}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u017c\u0105danie (request)"})," to pasa\u017cer, kt\xf3ry chce dosta\u0107 si\u0119 do samolotu \u2708\ufe0f"]}),"\n",(0,d.jsxs)(n.li,{children:["Zanim jednak tam trafi, musi przej\u015b\u0107 przez kilka ",(0,d.jsx)(n.strong,{children:"kontroli"})," \u2014 to w\u0142a\u015bnie ",(0,d.jsx)(n.em,{children:"middleware\u2019y"})," w Expressie."]}),"\n"]}),(0,d.jsx)(n.p,{children:"Ka\u017cdy middleware:"}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["mo\u017ce co\u015b ",(0,d.jsx)(n.strong,{children:"sprawdzi\u0107"})," (np. czy masz paszport \u2192 autoryzacja),"]}),"\n",(0,d.jsxs)(n.li,{children:["mo\u017ce co\u015b ",(0,d.jsx)(n.strong,{children:"doda\u0107"})," (np. dane z JSON-a \u2192 ",(0,d.jsx)(n.code,{children:"req.body"}),"),"]}),"\n",(0,d.jsxs)(n.li,{children:["mo\u017ce ",(0,d.jsx)(n.strong,{children:"zatrzyma\u0107 Ci\u0119"})," (np. b\u0142\u0105d 401),"]}),"\n",(0,d.jsxs)(n.li,{children:["albo przepu\u015bci\u0107 dalej (",(0,d.jsx)(n.code,{children:"next()"}),")."]}),"\n"]}),(0,d.jsxs)(n.p,{children:["Je\u015bli middleware nie wywo\u0142a ",(0,d.jsx)(n.code,{children:"next()"}),":"]}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"pasa\u017cer zostaje zatrzymany i"}),"\n",(0,d.jsx)(n.li,{children:"nie dociera do samolotu."}),"\n"]})]}),"\n",(0,d.jsx)(n.h2,{id:"syntaktyka-middlewarea",children:"Syntaktyka Middleware`a"}),"\n",(0,d.jsx)(n.p,{children:"Wz\xf3r funkcji Middleware:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"(req, res, next) => {\n// co\u015b robimy z \u017c\u0105daniem lub odpowiedzi\u0105\nnext(); // przekazuje sterowanie do kolejnego middleware\u2019a lub endpointu\n}\n\n"})}),"\n",(0,d.jsx)(n.h2,{id:"przyk\u0142ad",children:"Przyk\u0142ad"}),"\n",(0,d.jsx)(n.h3,{id:"middleware-dla-zapytania-pod-dowoln\u0105-\u015bcie\u017ck\u0105",children:"Middleware dla zapytania pod dowoln\u0105 \u015bcie\u017ck\u0105"}),"\n",(0,d.jsxs)(n.admonition,{type:"tip",children:[(0,d.jsx)(n.mdxAdmonitionTitle,{children:(0,d.jsx)(n.code,{children:"app.use()"})}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"dodaje middleware,"}),"\n",(0,d.jsx)(n.li,{children:"bez dookre\u015blenia \u015bcie\u017cki dzia\u0142a dla wszystkich zapyta\u0144."}),"\n"]})]}),"\n",(0,d.jsxs)(n.p,{children:["Do naszego pliku ",(0,d.jsx)(n.code,{children:"app.ts"})," dopiszemy pierwszy middleware:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"//...\nconst app = express();\n\n// TO JEST MIDDLEWARE !!!\napp.use((req, res, next) => {\n    console.log(`${req.method} ${req.url}`);\n    next(); // przejd\u017a dalej\n});\n//...\n\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"middleware-tylko-dla-\u015bcie\u017cek-house",children:["Middleware tylko dla \u015bcie\u017cek ",(0,d.jsx)(n.code,{children:"/house"})]}),"\n",(0,d.jsxs)(n.p,{children:["Do naszego pliku ",(0,d.jsx)(n.code,{children:"app.ts"})," dopiszemy drugi middleware:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:'//...\nconst app = express();\n//..\n\n// Middleware aktywny TYLKO dla \u015bcie\u017cek zaczynaj\u0105cych si\u0119 od /house\napp.use("/house", (req, res, next) => {\n    console.log("Middleware uruchomiony dla /house");\n    next(); // przepu\u015b\u0107 dalej do w\u0142a\u015bciwego endpointu\n});\n\n\n// Dopiszemy kilka \u015bcie\u017cek\n// \ud83d\udd39 przyk\u0142adowe endpointy\napp.get("/house", (req, res) => {\n    res.send("Witaj w domu!");\n});\n\napp.get("/house/room", (req, res) => {\n    res.send("To jest pok\xf3j w domu \ud83d\udecf\ufe0f");\n});\n\napp.get("/garden", (req, res) => {\n    res.send("Tu nie dzia\u0142a middleware \ud83e\udeb4");\n});\n//...\n\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Dopiszymy do naszego klienta ",(0,d.jsx)(n.code,{children:".http"})," kilka testowych zapyta\u0144"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-http",metastring:"request",children:"@baseUrl = http://localhost:3000/\n\n### pelne zapytanie\nGET http://localhost:3000\nAccept: application/json\n\n### zapytanie skr\xf3cone\nGET {{baseUrl}}\nAccept: application/json\n\n# NOWE ZAPYTANIA\n\n### zapytanie pod house\nGET {{baseUrl}}/house\nAccept: application/json\n\n### zapytanie pod house\nGET {{baseUrl}}/house/room\nAccept: application/json\n\n### zapytanie pod garden bez middleware\nGET {{baseUrl}}/graden\nAccept: application/json\n\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsxs)(n.p,{children:["Przywr\xf3\u0107my stan ",(0,d.jsx)(n.code,{children:"app.ts"})," i ",(0,d.jsx)(n.code,{children:".http"})," do poprzedniego stanu."]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"appuseexpressjson",children:"`app.use(express.json())"}),"\n",(0,d.jsxs)(n.admonition,{type:"info",children:[(0,d.jsxs)(n.mdxAdmonitionTitle,{children:["Co robi  ",(0,d.jsx)(n.code,{children:"app.use(express.json())"})]}),(0,d.jsx)(n.p,{children:"To middleware (czyli funkcja po\u015brednicz\u0105ca), kt\xf3ry m\xf3wi Expressowi:\n\u201eJe\u015bli klient wysy\u0142a dane w formacie JSON,"}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"odczytaj je,"}),"\n",(0,d.jsx)(n.li,{children:"przetw\xf3rz i"}),"\n",(0,d.jsxs)(n.li,{children:["zapisz w ",(0,d.jsx)(n.code,{children:"req.body"})," jako obiekt JavaScript.\u201d"]}),"\n"]})]}),"\n",(0,d.jsxs)(n.p,{children:["Za\u0142\xf3\u017cmy, \u017ce klient wysy\u0142a \u017c\u0105danie (",(0,d.jsx)(n.code,{children:"request"}),"):"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-http",metastring:"request",children:'POST /games\nContent-Type: application/json\n\n{\n  "title": "Doom",\n  "year": 1993,\n  "platform": "PC"\n}\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u017b\u0105danie jest przechwytywane przez middleware ",(0,d.jsx)(n.code,{children:"express.json()"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Express:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"czyta surowe dane JSON z \u017c\u0105dania,"}),"\n",(0,d.jsx)(n.li,{children:"parsuje (konwertuje) je do obiektu JS,"}),"\n",(0,d.jsxs)(n.li,{children:["udost\u0119pnia je w ",(0,d.jsx)(n.code,{children:"req.body"}),", wi\u0119c mo\u017cesz ich u\u017cywa\u0107 w kodzie."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:"czyli w kodzie mo\u017cemy odczyta\u0107 np. tytu\u0142 tego obiektu:"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:'app.post("/games", (req, res) => {\n  console.log(req.body.title); // \ud83d\udc49 "Doom"\n  res.send(`Dodano gr\u0119: ${req.body.title}`);\n});\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Dodajmy ten middleware do naszego pliku ",(0,d.jsx)(n.code,{children:"app.ts"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:'//...\n\nconst app = express();\n\napp.use(express.json());\n\napp.get("/", (req, res) => {\n    res.send("RetroGames APU. Use/games to see the games");\n})\n//...\n'})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var i=s(6540);const d={},r=i.createContext(d);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);