"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[8979],{130:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"ExpressJS/Express/RetroGamesDB/DaneWJSON","title":"CRUD z JSON","description":"Na razie restart serwera przywraca\u0142 pierwotne dane, bo wcale nie modyfikowali\u015bmy pliku gamesData.ts.","source":"@site/docs/3. ExpressJS/50.Express/20.RetroGamesDB/95.DaneWJSON.mdx","sourceDirName":"3. ExpressJS/50.Express/20.RetroGamesDB","slug":"/ExpressJS/Express/RetroGamesDB/DaneWJSON","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/DaneWJSON","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3. ExpressJS/50.Express/20.RetroGamesDB/95.DaneWJSON.mdx","tags":[],"version":"current","sidebarPosition":95,"frontMatter":{"title":"CRUD z JSON"},"sidebar":"tutorialSidebar","previous":{"title":"Tworzymy `middleware`y","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/WlasneMiddleware"},"next":{"title":"Wzorzec CSR - *Controller-Service-Repository Pattern*","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/MVC"}}');var a=n(4848),t=n(8453);const o={title:"CRUD z JSON"},i="CRUD z JSON",c={},d=[{value:"Zamiana <code>gamesData.ts</code> na plik <code>gamesData.json</code>.",id:"zamiana-gamesdatats-na-plik-gamesdatajson",level:2},{value:"Definicja funkcji pomocniczych",id:"definicja-funkcji-pomocniczych",level:2},{value:"<code>GET</code> - refaktoryzacja kodu w <code>routes/games.ts</code>",id:"get---refaktoryzacja-kodu-w-routesgamests",level:2},{value:"Refactoryzacja <code>GET /games</code>",id:"refactoryzacja-get-games",level:3},{value:"Refactoryzacja <code>GET /games/3</code>",id:"refactoryzacja-get-games3",level:3}];function l(e){const r={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"crud-z-json",children:"CRUD z JSON"})}),"\n",(0,a.jsxs)(r.p,{children:["Na razie restart serwera przywraca\u0142 pierwotne dane, bo wcale nie modyfikowali\u015bmy pliku ",(0,a.jsx)(r.code,{children:"gamesData.ts"}),"."]}),"\n",(0,a.jsxs)(r.h2,{id:"zamiana-gamesdatats-na-plik-gamesdatajson",children:["Zamiana ",(0,a.jsx)(r.code,{children:"gamesData.ts"})," na plik ",(0,a.jsx)(r.code,{children:"gamesData.json"}),"."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-json",children:'[\n    { "id": 1, "title": "Super Mario Bros.", "year": 1985, "platform": "NES", "genre": "Platform" },\n    { "id": 2, "title": "Pong", "year": 1972, "platform": "Arcade", "genre": "Sport" },\n    { "id": 3, "title": "Boulder Dash", "year": 1984, "platform": "Atari 800XL", "genre": "Action" },\n    { "id": 4, "title": "River Raid", "year": 1982, "platform": "Atari 800XL", "genre": "Shooter" },\n    { "id": 5, "title": "Asteroids", "year": 1979, "platform": "Arcade", "genre": "Shooter" },\n    { "id": 6, "title": "Space Invaders", "year": 1978, "platform": "Arcade", "genre": "Shooter" },\n    { "id": 7, "title": "Sabre Wulf", "year": 1984, "platform": "ZX Spectrum", "genre": "Adventure" },\n    { "id": 8, "title": "Impossible Mission", "year": 1984, "platform": "Commodore 64", "genre": "Adventure" }\n]\n\n'})}),"\n",(0,a.jsx)(r.h2,{id:"definicja-funkcji-pomocniczych",children:"Definicja funkcji pomocniczych"}),"\n",(0,a.jsxs)(r.p,{children:["Zasad\u0119 ",(0,a.jsx)(r.em,{children:"seperation of concerns"})," stosujemy w tym projekcie:"]}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["potrzebujemy modu\u0142\xf3w: ",(0,a.jsx)(r.code,{children:"fs"})," i ",(0,a.jsx)(r.code,{children:"path"}),","]}),"\n",(0,a.jsxs)(r.li,{children:["zdefiniujemy pomocnicze funkcje (",(0,a.jsx)(r.code,{children:"utils/fileUtiles.ts"}),"):","\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"readJSON"})," ,"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"writeJSON"}),","]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["utw\xf3rz nowy folder ",(0,a.jsx)(r.code,{children:"src/utlis"})]}),"\n",(0,a.jsxs)(r.li,{children:["wewn\u0105trz tego folderu utw\xf3rz plik ",(0,a.jsx)(r.code,{children:"fileUtils.ts"})]}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:'import fs from "fs"\nimport path from "path"\n\n\nexport function readJSON(fileName: string): any[] {\n    const filePath = path.join(__dirname, "..", "data", fileName)\n    const data = fs.readFileSync(filePath, "utf-8");\n    return JSON.parse(data);\n}\n\nexport function writeJSON(fileName: string, data:any[]): void {\n    const filePath = path.join(__dirname, "..", fileName)\n    fs.writeFileSync(filePath, JSON.stringify(data, null, 2), "utf-8");\n}\n'})}),"\n",(0,a.jsxs)(r.h2,{id:"get---refaktoryzacja-kodu-w-routesgamests",children:[(0,a.jsx)(r.code,{children:"GET"})," - refaktoryzacja kodu w ",(0,a.jsx)(r.code,{children:"routes/games.ts"})]}),"\n",(0,a.jsxs)(r.p,{children:["Zakomentujmy wszystkie ",(0,a.jsx)(r.code,{children:"route."})]}),"\n",(0,a.jsxs)(r.h3,{id:"refactoryzacja-get-games",children:["Refactoryzacja ",(0,a.jsx)(r.code,{children:"GET /games"})]}),"\n",(0,a.jsxs)(r.p,{children:["Plik ",(0,a.jsx)(r.code,{children:"routes/games.ts"})," bez cz\u0119\u015bci zakomentowanej, ale z nowym kodem:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:'import express, {Request, Response} from "express";\nimport{ readJSON, writeJSON } from "../utils/fileUtils";\n\nconst router = express.Router();\nconst fileName = "gamesData.json";\n\n\nrouter.get("/", (req: Request, res: Response) => {\n    const games = readJSON(fileName)\n    const {year, platform} = req.query;\n    console.log(year, platform)\n\n    if(!year && !platform) return res.json(games)\n\n    const filteredGames = games.filter(g => {\n        if (year && g.year > Number(year))  return false\n\n        if(platform){\n            if (typeof platform === "string"){\n                const queryPlatform = platform.toLowerCase();\n                const gamePlatform = g.platform.toLowerCase();\n                if(!gamePlatform.includes(queryPlatform)) return false;\n            }\n        }\n        return true\n    });\n    res.json(filteredGames);\n});\n\n//...\n\n\nexport default router;\n'})}),"\n",(0,a.jsxs)(r.p,{children:["Sprawd\u017a, czy ",(0,a.jsx)(r.code,{children:"request"})," ",(0,a.jsx)(r.code,{children:"GET http://localhost:3000/games"})," zwr\xf3ci list\u0119 gier, bo powinien."]}),"\n",(0,a.jsxs)(r.h3,{id:"refactoryzacja-get-games3",children:["Refactoryzacja ",(0,a.jsx)(r.code,{children:"GET /games/3"})]}),"\n",(0,a.jsx)(r.p,{children:"Pod poprzedni\u0105 metod\u0105 dopisujemy:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:'router.get("/:id", (req: Request, res: Response) => {\n    const games = readJSON(fileName)\n    const id = Number(req.params.id);\n    const game = games.find(g => g.id === Number(req.params.id));\n    if (!game) return res.status(404).json({ message: "Game not found" });\n    res.json(game);\n});\n\n'})})]})}function m(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>i});var s=n(6540);const a={},t=s.createContext(a);function o(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);