"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5331],{8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>d});var s=r(6540);const i={},o=s.createContext(i);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:n},e.children)}},9239:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>m,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"ExpressJS/Express/RetroGamesDB/CSR","title":"Wzorzec CSR - *Controller-Service-Repository Pattern*","description":"Controller-Service-Repository","source":"@site/docs/3. ExpressJS/50.Express/20.RetroGamesDB/100.CSR.mdx","sourceDirName":"3. ExpressJS/50.Express/20.RetroGamesDB","slug":"/ExpressJS/Express/RetroGamesDB/CSR","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/CSR","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3. ExpressJS/50.Express/20.RetroGamesDB/100.CSR.mdx","tags":[],"version":"current","sidebarPosition":100,"frontMatter":{"title":"Wzorzec CSR - *Controller-Service-Repository Pattern*"},"sidebar":"tutorialSidebar","previous":{"title":"CRUD z JSON","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/DaneWJSON"},"next":{"title":"MongoDB - wprowadzenie","permalink":"/web/docs/MongoDB/Wprowadzenie"}}');var i=r(4848),o=r(8453);const t={title:"Wzorzec CSR - *Controller-Service-Repository Pattern*"},d="Wzorzec CSR",l={},a=[{value:"Tworzymy <code>Repository</code>",id:"tworzymy-repository",level:2},{value:"Tworzymy <code>Service</code> - CRUD",id:"tworzymy-service---crud",level:2},{value:"Tworzymy <code>Controller</code>",id:"tworzymy-controller",level:2},{value:"Modyfikujemy <code>routes/games.ts</code>",id:"modyfikujemy-routesgamests",level:2}];function c(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"wzorzec-csr",children:"Wzorzec CSR"})}),"\n",(0,i.jsxs)(n.admonition,{title:"Co to jest CSR?",type:"note",children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"Controller-Service-Repository"}),"\n\u2013 to popularny wzorzec architektury backendowej,"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["oddziela od siebie:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"obs\u0142ug\u0119 HTTP,"}),"\n",(0,i.jsx)(n.li,{children:"logik\u0119 biznesow\u0105"}),"\n",(0,i.jsx)(n.li,{children:"dost\u0119p do danych."}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"W skr\xf3cie:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Controller"})," obs\u0142uguje ",(0,i.jsx)(n.em,{children:"request"}),", formu\u0142uje ",(0,i.jsx)(n.em,{children:"response"}),","]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Service"})," zawiera logik\u0119 aplikacji, operacje na danych"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Repository"})," zajmuje si\u0119 komunikacj\u0105 z baz\u0105 danych lub plikami."]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{title:"CSR metaforycznie",type:"tip",children:[(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Controller"})," m\xf3wi \u201eco klient chce\u201d,"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Service"})," m\xf3wi \u201ejak to zrobi\u0107 zgodnie z zasadami firmy\u201d,"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Repository"})," m\xf3wi tylko \u201egdzie to le\u017cy i jak zapisa\u0107\u201d."]}),"\n"]}),(0,i.jsx)(n.p,{children:"bardziej metaforycznie CSR jako Netflix"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Controller"})," aplikacja na telewizorze / strona internetowa","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:['"Klikasz ',(0,i.jsx)(n.em,{children:"Odtw\xf3rz Stranger Things"}),' i dostajesz film"']}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Service"})," M\xf3zg Netflixa","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'"Wie, \u017ce masz konto premium"'}),"\n",(0,i.jsx)(n.li,{children:'"Wie, \u017ce ju\u017c obejrza\u0142e\u015b 3 sezony, \u017ce teraz mo\u017cesz 4"'}),"\n",(0,i.jsx)(n.li,{children:'"Wie, \u017ce w Polsce ten serial ma polskie napisy"'}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Repository"})," serwery z filmami (Amazon S3, bazy danych)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'"Tylko oddaje plik wideo i metadane"'}),"\n",(0,i.jsx)(n.li,{children:'"Nie wie kto ogl\u0105da i dlaczego"'}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(n.h2,{id:"tworzymy-repository",children:["Tworzymy ",(0,i.jsx)(n.code,{children:"Repository"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["zamie\u0144my nazw\u0119 folderu ",(0,i.jsx)(n.code,{children:"models"})," na ",(0,i.jsx)(n.code,{children:"types"}),", aby uzgodni\u0107 struktur\u0119 z dobrymi praktykami w Node.js + TypeScript"]}),"\n",(0,i.jsxs)(n.li,{children:["utworzymy folder ",(0,i.jsx)(n.code,{children:"repository"})," w ",(0,i.jsx)(n.code,{children:"src"})]}),"\n",(0,i.jsxs)(n.li,{children:["utworzymy plik ",(0,i.jsx)(n.code,{children:"games.repository.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { readJSON, writeJSON } from "../utils/fileUtils"\nimport { Game } from "../types/game";\n\nconst fileName = "gamesData.json";\n\nexport function findAll(): Game[] {\n    return readJSON(fileName);\n}\n\nexport function findById(id: number): Game | undefined {\n    return readJSON(fileName).find(g => g.id === id);\n}\n\nexport function save(games: Game[]): void {\n    writeJSON(fileName, games);\n}\n\nexport function deleteById(id: number): Game | null {\n    const games: Game[] = readJSON(fileName);\n    const index = games.findIndex(g => g.id === id);\n    if (index === -1) return null;\n\n    const deleted: Game = games.splice(index, 1)[0];\n    writeJSON(fileName, games);\n\n    return deleted;\n}\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"tworzymy-service---crud",children:["Tworzymy ",(0,i.jsx)(n.code,{children:"Service"})," - CRUD"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"utw\xf3rz folder `src/services"}),"\n",(0,i.jsxs)(n.li,{children:["w folderze utw\xf3rz plik ",(0,i.jsx)(n.code,{children:"games.service.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { Game } from "../types/Game";\nimport * as repo from "../repositories/games.repository";\n\nexport function getAllGames() {\n    return repo.findAll();\n}\n\nexport function getGameById(id: number) {\n    return repo.findById(id);\n}\n\nexport function createGame(data: Omit<Game, "id">) {\n    const games = repo.findAll();\n    const newGame: Game = {\n        id: Date.now(),\n        ...data\n    };\n    games.push(newGame);\n    repo.save(games);\n    return newGame;\n}\n\nexport function updateGame(id: number, update: Partial<Game>) {\n    const games = repo.findAll();\n    const index = games.findIndex(g => g.id === id);\n    if (index === -1) return null;\n\n    games[index] = { ...games[index], ...update, id };\n    repo.save(games);\n    return games[index];\n}\n\nexport function deleteGame(id: number) {\n    const games = repo.findAll();\n    const index = games.findIndex(g => g.id === id);\n    if (index === -1) return null;\n\n    const deleted = games.splice(index, 1)[0];\n    repo.save(games);\n    return deleted;\n}\n\n\n\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"tworzymy-controller",children:["Tworzymy ",(0,i.jsx)(n.code,{children:"Controller"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["utworzymy folder ",(0,i.jsx)(n.code,{children:"controllers"})]}),"\n",(0,i.jsxs)(n.li,{children:["utworzymy plik ",(0,i.jsx)(n.code,{children:"games.controller.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { Request, Response } from "express";\nimport * as service from "../services/games.sevice";\n\nexport function getAll(req: Request, res: Response) {\n    res.json(service.getAllGames());\n}\n\nexport function getOne(req: Request, res: Response) {\n    const game = service.getGameById(Number(req.params.id));\n    if (!game) return res.status(404).json({ message: "Game not found" });\n    res.json(game);\n}\n\nexport function create(req: Request, res: Response) {\n    const newGame = service.createGame(req.body);\n    res.status(201).json(newGame);\n}\n\nexport function update(req: Request, res: Response) {\n    const updated = service.updateGame(Number(req.params.id), req.body);\n    if (!updated) return res.status(404).json({ message: "Game not found" });\n    res.json(updated);\n}\n\nexport function remove(req: Request, res: Response) {\n    const deleted = service.deleteGame(Number(req.params.id));\n    if (!deleted) return res.status(404).json({ message: "Game not found" });\n    res.json(deleted);\n}\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"modyfikujemy-routesgamests",children:["Modyfikujemy ",(0,i.jsx)(n.code,{children:"routes/games.ts"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["zmie\u0144my nazw\u0119 tego pliku na ",(0,i.jsx)(n.code,{children:"games.routes.ts"})]}),"\n",(0,i.jsx)(n.li,{children:"zawarto\u015b\u0107 tego pliku to teraz tylko:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import * as controller from "../controllers/games.controller";\nimport { validateGame } from "../middlewares/gameValidator";\nimport { validateId } from "../middlewares/validateId";\n\nconst router = Router();\n\nrouter.get("/", controller.getAll);\nrouter.get("/:id", validateId, controller.getOne);\n\nrouter.post("/", validateGame, controller.create);\nrouter.put("/:id", validateId, validateGame, controller.update);\nrouter.patch("/:id", validateId, controller.update);\n\nrouter.delete("/:id", validateId, controller.remove);\n\nexport default router;\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["dopasowa\u0142em nazw\u0119 pliku do nazwy ",(0,i.jsx)(n.code,{children:"gameValidator"})," (bo by\u0142 ",(0,i.jsx)(n.code,{children:"GameValidator"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["brakuje nam middleware ",(0,i.jsx)(n.code,{children:"validateId"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { Request, Response, NextFunction } from "express";\n\nexport function validateId(req: Request, res: Response, next: NextFunction) {\n    const id = Number(req.params.id);\n\n    // Czy to liczba?\n    if (isNaN(id)) {\n        return res.status(400).json({\n            message: "Invalid ID: ID must be a number."\n        });\n    }\n\n    // Czy dodatnia?\n    if (id <= 0) {\n        return res.status(400).json({\n            message: "Invalid ID: ID must be a positive number."\n        });\n    }\n\n    // OK \u2192 przechodzimy dalej\n    next();\n}\n\n'})})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);