"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[8243],{3336:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>j,frontMatter:()=>o,metadata:()=>a,toc:()=>s});const a=JSON.parse('{"id":"MongoDB/Agregacja","title":"Agregacja","description":"Teoria","source":"@site/docs/4. MongoDB/60.Agregacja.mdx","sourceDirName":"4. MongoDB","slug":"/MongoDB/Agregacja","permalink":"/web/docs/MongoDB/Agregacja","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/4. MongoDB/60.Agregacja.mdx","tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"title":"Agregacja"},"sidebar":"tutorialSidebar","previous":{"title":"Projekcja","permalink":"/web/docs/MongoDB/ProjekcjaIFiltrowanie"},"next":{"title":"Operator $lookup","permalink":"/web/docs/MongoDB/\u0141\u0105czenie"}}');var r=i(4848),d=i(8453);const o={title:"Agregacja"},l="Agregacja",c={},s=[{value:"Teoria",id:"teoria",level:2},{value:"Definicja",id:"definicja",level:3},{value:"Struktura agregacji",id:"struktura-agregacji",level:3},{value:"Prosty przyk\u0142ad",id:"prosty-przyk\u0142ad",level:3},{value:"<code>find()</code> i <code>aggregate()</code>",id:"find-i-aggregate",level:3},{value:"Praktyka",id:"praktyka",level:2},{value:"Zapytania",id:"zapytania",level:3},{value:"Wybierzmy tylko warzywa",id:"wybierzmy-tylko-warzywa",level:4},{value:"Z warzyw wy\u015bwietlmy tylko nazw\u0119 i kaloryczno\u015b\u0107",id:"z-warzyw-wy\u015bwietlmy-tylko-nazw\u0119-i-kaloryczno\u015b\u0107",level:4},{value:"Grupujemy <code>$group</code>",id:"grupujemy-group",level:3},{value:"Ile produk\xf3w w danej kategorii",id:"ile-produk\xf3w-w-danej-kategorii",level:4},{value:"\u015arednia liczba kalorii w ka\u017cdej kategorii",id:"\u015brednia-liczba-kalorii-w-ka\u017cdej-kategorii",level:4},{value:"Najmniej i najbardziej kaloryczny produkt w kategorii",id:"najmniej-i-najbardziej-kaloryczny-produkt-w-kategorii",level:4},{value:"Lista nazw produkt\xf3w w ka\u017cdej kategorii",id:"lista-nazw-produkt\xf3w-w-ka\u017cdej-kategorii",level:4},{value:"Sortujemy",id:"sortujemy",level:3},{value:"Sortowanie po kaloriach malej\u0105co (najbardziej kaloryczne)",id:"sortowanie-po-kaloriach-malej\u0105co-najbardziej-kaloryczne",level:4},{value:"Sortowanie po kategorii, a w ramach kategorii po kaloriach",id:"sortowanie-po-kategorii-a-w-ramach-kategorii-po-kaloriach",level:4},{value:"Dwa najbardziej kaloryczne produkty",id:"dwa-najbardziej-kaloryczne-produkty",level:4},{value:"Ograniczenia wynik\xf3w - <code>limit</code>",id:"ograniczenia-wynik\xf3w---limit",level:3},{value:"Najbardziej kaloryczny produkt w ka\u017cdej kategorii",id:"najbardziej-kaloryczny-produkt-w-ka\u017cdej-kategorii",level:4},{value:"Pierwsze 3 produkty po alfabecie (projekcja + limit)",id:"pierwsze-3-produkty-po-alfabecie-projekcja--limit",level:4},{value:"Zliczanie dokument\xf3w",id:"zliczanie-dokument\xf3w",level:2},{value:"Zliczanie podstawowe",id:"zliczanie-podstawowe",level:3},{value:"Zliczanie w agregacji",id:"zliczanie-w-agregacji",level:3},{value:"Zliczamy wszystkie dokumenty",id:"zliczamy-wszystkie-dokumenty",level:4},{value:"Zliczanie dokument\xf3w w kategoriach",id:"zliczanie-dokument\xf3w-w-kategoriach",level:4},{value:"Zliczanie tylko owoc\xf3w i warzyw",id:"zliczanie-tylko-owoc\xf3w-i-warzyw",level:4},{value:"Ile produkt\xf3w ma dok\u0142adnie 2 witaminy?",id:"ile-produkt\xf3w-ma-dok\u0142adnie-2-witaminy",level:4},{value:"\u015arednia liczba witamin na produkt",id:"\u015brednia-liczba-witamin-na-produkt",level:4},{value:"Wracamy do bazy danych z kresk\xf3wkami",id:"wracamy-do-bazy-danych-z-kresk\xf3wkami",level:2},{value:"Przygotowanie bazy i danych",id:"przygotowanie-bazy-i-danych",level:2},{value:"Pytania do bazy",id:"pytania-do-bazy",level:2}];function t(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"agregacja",children:"Agregacja"})}),"\n",(0,r.jsx)(n.h2,{id:"teoria",children:"Teoria"}),"\n",(0,r.jsx)(n.h3,{id:"definicja",children:"Definicja"}),"\n",(0,r.jsxs)(n.admonition,{title:"Co to jest agregacja?",type:"info",children:[(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Agregacja to spos\xf3b przetwarzania danych w etapach (",(0,r.jsx)(n.em,{children:"pipeline"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Ka\u017cdy etap bierze dane z poprzedniego i zmienia je lub filtruje."}),"\n"]}),(0,r.jsx)(n.admonition,{title:"W MongoDB ka\u017cdy taki etap to operator zaczynaj\u0105cy si\u0119 od $:",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$match"})," \u2013 wybiera dokumenty"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$project"})," \u2013 wybiera pola / tworzy nowe pola"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$group"})," \u2013 grupuje i liczy"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$sort"})," \u2013 sortuje"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$limit"})," \u2013 ogranicza wynik"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$count"})," \u2013 liczy dokumenty"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$lookup"})," \u2013 do\u0142\u0105cza dane z innej kolekcji (prawie jak JOIN)"]}),"\n"]})})]}),"\n",(0,r.jsx)(n.h3,{id:"struktura-agregacji",children:"Struktura agregacji"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"db.collection.aggregate([\n  { etap1 },\n  { etap2 },\n  { etap3 }\n])\n"})}),"\n",(0,r.jsx)(n.h3,{id:"prosty-przyk\u0142ad",children:"Prosty przyk\u0142ad"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"db.users.aggregate([\n  { $match: { age: { $gt: 18 } } },\n  { $project: { name: 1, age: 1 } }\n])\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$match"}),"      wybierz pe\u0142noletnich"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$project"}),"    poka\u017c tylko imi\u0119 i wiek"]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"find-i-aggregate",children:[(0,r.jsx)(n.code,{children:"find()"})," i ",(0,r.jsx)(n.code,{children:"aggregate()"})]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"find()"}),(0,r.jsx)(n.th,{children:"aggregate()"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Filtruje dokumenty"}),(0,r.jsx)(n.td,{children:"Filtruje i przetwarza dokumenty w etapach"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Poka\u017c wybrane pola"}),(0,r.jsx)(n.td,{children:"Tw\xf3rz nowe pola, zmieniaj struktur\u0119"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tylko proste zapytania"}),(0,r.jsx)(n.td,{children:"Statystyki, grupowanie, sortowanie"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Nie robi JOIN"}),(0,r.jsxs)(n.td,{children:["Ma ",(0,r.jsx)(n.code,{children:"$lookup"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Bardzo proste"}),(0,r.jsx)(n.td,{children:"Bardzo pot\u0119\u017cne"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"praktyka",children:"Praktyka"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["tworzymy baz\u0119 ",(0,r.jsx)(n.code,{children:"use foodDB"})]}),"\n",(0,r.jsxs)(n.li,{children:["tworzymy kolekcj\u0119 ",(0,r.jsx)(n.code,{children:'db.createCollection("foods")'})]}),"\n",(0,r.jsxs)(n.li,{children:["wprowadzamy dane przez interfejs ",(0,r.jsx)(n.em,{children:"Compass"})," -> ",(0,r.jsx)(n.code,{children:"Documents"})," > ",(0,r.jsx)(n.code,{children:"+"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'/**\n* Paste one or more documents here\n*/\n[\n  { "name": "Apple",      "category": "fruit",  "calories": 52,  "vitamins": ["A", "C"] },\n  { "name": "Banana",     "category": "fruit",  "calories": 96,  "vitamins": ["B6", "C"] },\n  { "name": "Carrot",     "category": "vegetable", "calories": 41, "vitamins": ["A", "K"] },\n  { "name": "Broccoli",   "category": "vegetable", "calories": 55, "vitamins": ["C", "K"] },\n  { "name": "Chicken",    "category": "meat",   "calories": 239, "vitamins": ["B6"] }\n]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"zapytania",children:"Zapytania"}),"\n",(0,r.jsx)(n.h4,{id:"wybierzmy-tylko-warzywa",children:"Wybierzmy tylko warzywa"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {$match: { category: "vegetable"}}\n])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"z-warzyw-wy\u015bwietlmy-tylko-nazw\u0119-i-kaloryczno\u015b\u0107",children:"Z warzyw wy\u015bwietlmy tylko nazw\u0119 i kaloryczno\u015b\u0107"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {$match: { category: "vegetable"}},\n  {$project: {name: 1, calories: 1, _id:0}}\n])\n'})}),"\n",(0,r.jsxs)(n.p,{children:["To samo w ",(0,r.jsx)(n.em,{children:"Compass"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["wybieramy zak\u0142adk\u0119 ",(0,r.jsx)(n.code,{children:"Aggregations"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["tworzymy nowy ",(0,r.jsx)(n.code,{children:"stage"})," przez naci\u015bni\u0119cie przyciku ",(0,r.jsx)(n.code,{children:"Add stage"})]}),"\n",(0,r.jsxs)(n.li,{children:["w ",(0,r.jsx)(n.code,{children:"Stage 1 <Select> "})," wybieramy ",(0,r.jsx)(n.code,{children:"$match"})," i wpisujemy:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'{category: "vegetable"}'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["w ",(0,r.jsx)(n.code,{children:"Stage 2 <Select> "})," wybieramy ",(0,r.jsx)(n.code,{children:"$project"})," i wpisujemy:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"{ name:1, calories: 1, _id:0 }"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"grupujemy-group",children:["Grupujemy ",(0,r.jsx)(n.code,{children:"$group"})]}),"\n",(0,r.jsx)(n.h4,{id:"ile-produk\xf3w-w-danej-kategorii",children:"Ile produk\xf3w w danej kategorii"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([{\n $group: {\n  \t_id: "$category",\n    totalFoods: {$sum: 1}\n }\n}])\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_id"}),"     pole, po kt\xf3rym grupujemy (tu: kategoria jedzenia)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$sum: 1"})," dodaj 1 dla ka\u017cdego dokumentu"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.mdxAdmonitionTitle,{children:["Co to jest ",(0,r.jsx)(n.code,{children:"$category"})]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"$category"'})," oznacza: \u201ewe\u017a warto\u015b\u0107 pola ",(0,r.jsx)(n.code,{children:"category"})," z ka\u017cdego dokumentu\u201d"]}),"\n",(0,r.jsxs)(n.li,{children:["Czyli:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["bez ",(0,r.jsx)(n.code,{children:"$"}),' to zwyk\u0142y tekst "category"']}),"\n",(0,r.jsxs)(n.li,{children:["z ",(0,r.jsx)(n.code,{children:"$"})," to odwo\u0142anie do pola w dokumencie"]}),"\n"]}),"\n"]}),"\n"]}),(0,r.jsx)(n.p,{children:"to tak, jaby\u015bmy powiedzieli:\n\u201eGrupuj dokumenty wed\u0142ug tego, co jest zapisane w polu category\u201d."})]}),"\n",(0,r.jsx)(n.h4,{id:"\u015brednia-liczba-kalorii-w-ka\u017cdej-kategorii",children:"\u015arednia liczba kalorii w ka\u017cdej kategorii"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {\n    $group: {\n      _id: "$category",\n      avgCalories: { $avg: "$calories" }\n    }\n  }\n])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"najmniej-i-najbardziej-kaloryczny-produkt-w-kategorii",children:"Najmniej i najbardziej kaloryczny produkt w kategorii"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {\n    $group: {\n      _id: "$category",\n      minCalories: { $min: "$calories" },\n      maxCalories: { $max: "$calories" }\n    }\n  }\n])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"lista-nazw-produkt\xf3w-w-ka\u017cdej-kategorii",children:"Lista nazw produkt\xf3w w ka\u017cdej kategorii"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {\n    $group: {\n      _id: "$category",\n      products: { $push: "$name" }\n        }\n    }\n])\n'})}),"\n",(0,r.jsx)(n.h3,{id:"sortujemy",children:"Sortujemy"}),"\n",(0,r.jsx)(n.h4,{id:"sortowanie-po-kaloriach-malej\u0105co-najbardziej-kaloryczne",children:"Sortowanie po kaloriach malej\u0105co (najbardziej kaloryczne)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"db.foods.aggregate([\n  { $sort: { calories: -1 } }\n])\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.mdxAdmonitionTitle,{children:["sortowanie ",(0,r.jsx)(n.code,{children:"1"}),", ",(0,r.jsx)(n.code,{children:"-1"})]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"sortowanie w agregacji,"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-1"})," = malej\u0105co, ",(0,r.jsx)(n.code,{children:"1 ="})," rosn\u0105co."]}),"\n"]})]}),"\n",(0,r.jsx)(n.h4,{id:"sortowanie-po-kategorii-a-w-ramach-kategorii-po-kaloriach",children:"Sortowanie po kategorii, a w ramach kategorii po kaloriach"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"db.foods.aggregate([\n  { $sort: { category: 1, calories: -1 } }\n])\n"})}),"\n",(0,r.jsx)(n.h4,{id:"dwa-najbardziej-kaloryczne-produkty",children:"Dwa najbardziej kaloryczne produkty"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"db.foods.aggregate([\n  { $sort: { calories: -1 } },\n  { $limit: 2 }\n])\n\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"ograniczenia-wynik\xf3w---limit",children:["Ograniczenia wynik\xf3w - ",(0,r.jsx)(n.code,{children:"limit"})]}),"\n",(0,r.jsx)(n.h4,{id:"najbardziej-kaloryczny-produkt-w-ka\u017cdej-kategorii",children:"Najbardziej kaloryczny produkt w ka\u017cdej kategorii"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  { $sort: { calories: -1 } },\n  {\n    $group: {\n      _id: "$category",\n      topFood: { $first: "$$ROOT" }\n    }\n  },\n  { $limit: 3 }\n])\n'})}),"\n",(0,r.jsxs)(n.admonition,{title:"Co si\u0119 dzieje krok po kroku?",type:"tip",children:[(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$sort"}),"   dokumenty s\u0105 posortowane od najbardziej kalorycznych"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$group"}),"  MongoDB bierze dokumenty kategoria po kategorii"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$first"}),"  bierze pierwszy dokument w danej grupie"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$$ROOT"}),"  zapisuje ca\u0142y dokument, a nie tylko jedno pole"]}),"\n"]}),(0,r.jsx)(n.p,{children:"Efekt:\nDla ka\u017cdej kategorii dostajesz najbardziej kaloryczny produkt jako pe\u0142ny obiekt."})]}),"\n",(0,r.jsx)(n.p,{children:"Takie same zapytanie, ale w odpowiedzie dostajemy tylko nazw\u0119 produktu"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n    { $sort: { calories: -1 } },\n    {\n        $group: {\n            _id: "$category",\n            topFood: { $first: "$name" }\n        }\n    },\n    { $limit: 3 }\n])\n\n'})}),"\n",(0,r.jsx)(n.h4,{id:"pierwsze-3-produkty-po-alfabecie-projekcja--limit",children:"Pierwsze 3 produkty po alfabecie (projekcja + limit)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"db.foods.aggregate([\n  { $sort: { name: 1 } },\n  { $limit: 3 },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      category: 1\n    }\n  }\n])\n\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$name"}),"   \u201ewe\u017a tylko imi\u0119\u201d"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$$ROOT"}),"  \u201ezr\xf3b ksero ca\u0142ego dokumentu\u201d"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"zliczanie-dokument\xf3w",children:"Zliczanie dokument\xf3w"}),"\n",(0,r.jsx)(n.h3,{id:"zliczanie-podstawowe",children:"Zliczanie podstawowe"}),"\n",(0,r.jsxs)(n.p,{children:["Policzenie wszystkich:\n",(0,r.jsx)(n.code,{children:"db.users.countDocuments()"})]}),"\n",(0,r.jsxs)(n.p,{children:["Policzenie z filtrem:\n",(0,r.jsx)(n.code,{children:"db.users.countDocuments({ age: { $gt: 18 } })"})]}),"\n",(0,r.jsx)(n.h3,{id:"zliczanie-w-agregacji",children:"Zliczanie w agregacji"}),"\n",(0,r.jsx)(n.p,{children:"Wracamy do naszej bazy danych z jedzeniem."}),"\n",(0,r.jsx)(n.h4,{id:"zliczamy-wszystkie-dokumenty",children:"Zliczamy wszystkie dokumenty"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  { $count: "totalProducts" }\n])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"zliczanie-dokument\xf3w-w-kategoriach",children:"Zliczanie dokument\xf3w w kategoriach"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {\n    $group: {\n      _id: "$category",\n      count: { $sum: 1 }\n    }\n  }\n])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"zliczanie-tylko-owoc\xf3w-i-warzyw",children:"Zliczanie tylko owoc\xf3w i warzyw"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  { $match: { category: { $in: ["fruit", "vegetable"] } } },\n  {\n    $group: {\n      _id: "$category",\n      count: { $sum: 1 }\n    }\n  }\n])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"ile-produkt\xf3w-ma-dok\u0142adnie-2-witaminy",children:"Ile produkt\xf3w ma dok\u0142adnie 2 witaminy?"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {\n    $project: {\n      name: 1,\n      vitaminsCount: { $size: "$vitamins" }\n    }\n  },\n  { $match: { vitaminsCount: 2 } },\n  { $count: "productsWithTwoVitamins" }\n])\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u015brednia-liczba-witamin-na-produkt",children:"\u015arednia liczba witamin na produkt"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.foods.aggregate([\n  {\n    $project: {\n      vitaminsCount: { $size: "$vitamins" }\n    }\n  },\n  {\n    $group: {\n      _id: null,\n      avgVitamins: { $avg: "$vitaminsCount" }\n    }\n  }\n])\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.mdxAdmonitionTitle,{children:[(0,r.jsx)(n.code,{children:"_id"})," w ",(0,r.jsx)(n.code,{children:"$group"})]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_id"})," okre\u015bla \u201epo czym dzielimy dokumenty na grupy\u201d"]}),"\n",(0,r.jsxs)(n.li,{children:["je\u017celi ",(0,r.jsx)(n.code,{children:"_id:null"}),"  oznacza \u201eNie dziel dokument\xf3w na grupy \u2013 wrzu\u0107 wszystkie do jednej\u201d"]}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"wracamy-do-bazy-danych-z-kresk\xf3wkami",children:"Wracamy do bazy danych z kresk\xf3wkami"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["pobieramy dokument ",(0,r.jsx)(n.em,{children:"Shrek"}),"a"]}),"\n",(0,r.jsxs)(n.li,{children:["chcemy wy\u015bwietli\u0107 imi\u0119 ",(0,r.jsx)(n.em,{children:"Shrek"})]}),"\n",(0,r.jsx)(n.li,{children:"chcemy wy\u015bwietl\u0107 przyjaciela Shreka"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'db.chartoonCharacters.aggregate([\n  { $match: { name: "Shrek" } },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      friend: { $arrayElemAt: ["$friends", 0] }\n    }\n  }\n])\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$slice"}),"          ogranicza liczb\u0119 element\xf3w tablicy"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$arrayElemAt"}),"    wyci\u0105ga konkretny element tablicy"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"find()"}),"          zwraca dane \u201ejak s\u0105\u201d"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aggregate()"}),"     pozwala zmienia\u0107 struktur\u0119 wyniku"]}),"\n"]})}),"\n",(0,r.jsx)(n.h1,{id:"\u0107wiczenia",children:"\u0106WICZENIA"}),"\n",(0,r.jsx)(n.h2,{id:"przygotowanie-bazy-i-danych",children:"Przygotowanie bazy i danych"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["baza danych: ",(0,r.jsx)(n.code,{children:"star_trekDB"})]}),"\n",(0,r.jsxs)(n.li,{children:["kolekcja ",(0,r.jsx)(n.code,{children:"characters"})]}),"\n",(0,r.jsx)(n.li,{children:"wprowad\u017a dane"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[\n  {\n    "name": "Jean-Luc Picard",\n    "species": "Human",\n    "rank": "Captain",\n    "ship": "USS Enterprise-D",\n    "series": "TNG",\n    "episodes": 178,\n    "age": 59,\n    "skills": ["diplomacy", "leadership"]\n  },\n  {\n    "name": "William Riker",\n    "species": "Human",\n    "rank": "Commander",\n    "ship": "USS Enterprise-D",\n    "series": "TNG",\n    "episodes": 176,\n    "age": 35,\n    "skills": ["tactics", "leadership"]\n  },\n  {\n    "name": "Spock",\n    "species": "Vulcan",\n    "rank": "Commander",\n    "ship": "USS Enterprise",\n    "series": "TOS",\n    "episodes": 79,\n    "age": 66,\n    "skills": ["logic", "science"]\n  },\n  {\n    "name": "Kathryn Janeway",\n    "species": "Human",\n    "rank": "Captain",\n    "ship": "USS Voyager",\n    "series": "VOY",\n    "episodes": 172,\n    "age": 42,\n    "skills": ["science", "leadership"]\n  },\n  {\n    "name": "Data",\n    "species": "Android",\n    "rank": "Lieutenant Commander",\n    "ship": "USS Enterprise-D",\n    "series": "TNG",\n    "episodes": 176,\n    "age": null,\n    "skills": ["science", "analysis"]\n  },\n  {\n    "name": "Worf",\n    "species": "Klingon",\n    "rank": "Lieutenant",\n    "ship": "USS Enterprise-D",\n    "series": "TNG",\n    "episodes": 172,\n    "age": 40,\n    "skills": ["combat", "tactics"]\n  }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"pytania-do-bazy",children:"Pytania do bazy"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Ilu bohater\xf3w pochodzi z ka\u017cdej serii?"}),"\n",(0,r.jsx)(n.li,{children:"Jaka jest \u015brednia liczba odcink\xf3w na seri\u0119?"}),"\n",(0,r.jsx)(n.li,{children:"Kt\xf3ry bohater wyst\u0105pi\u0142 w najwi\u0119kszej liczbie odcink\xf3w?"}),"\n",(0,r.jsx)(n.li,{children:"Ilu kapitan\xf3w jest w bazie i jacy to s\u0105?"}),"\n",(0,r.jsx)(n.li,{children:"\u015aredni wiek bohater\xf3w wed\u0142ug gatunku (pomijaj\u0105c androidy)"}),"\n",(0,r.jsx)(n.li,{children:"Ile postaci s\u0142u\u017cy\u0142o na ka\u017cdym statku?"}),"\n",(0,r.jsx)(n.li,{children:"Jakie umiej\u0119tno\u015bci wyst\u0119puj\u0105 najcz\u0119\u015bciej?"}),"\n",(0,r.jsx)(n.li,{children:"Kt\xf3re serie maj\u0105 bohater\xf3w z wi\u0119cej ni\u017c 150 odcinkami?"}),"\n",(0,r.jsx)(n.li,{children:"Najstarszy bohater w ka\u017cdej serii"}),"\n",(0,r.jsx)(n.li,{children:"\u015arednia liczba umiej\u0119tno\u015bci na bohatera"}),"\n"]})]})}function j(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var a=i(6540);const r={},d=a.createContext(r);function o(e){const n=a.useContext(d);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(d.Provider,{value:n},e.children)}}}]);