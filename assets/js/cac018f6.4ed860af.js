"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[7609],{7261:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>j,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"ExpressJS/SocketPierwszaAplikacja","title":"Socket prosta aplikacja","description":"Podstawowe poj\u0119cia","source":"@site/docs/3. ExpressJS/16.SocketPierwszaAplikacja.mdx","sourceDirName":"3. ExpressJS","slug":"/ExpressJS/SocketPierwszaAplikacja","permalink":"/web/docs/ExpressJS/SocketPierwszaAplikacja","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3. ExpressJS/16.SocketPierwszaAplikacja.mdx","tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"title":"Socket prosta aplikacja"},"sidebar":"tutorialSidebar","previous":{"title":"Sockets i modu\u0142 `net`","permalink":"/web/docs/ExpressJS/Socket"},"next":{"title":"Modu\u0142 `http`","permalink":"/web/docs/ExpressJS/ModulHttp"}}');var r=i(4848),o=i(8453);const c={title:"Socket prosta aplikacja"},t="Gdy serwer rozmawia\u0142 klientem - prosta aplikacja",l={},d=[{value:"Podstawowe poj\u0119cia",id:"podstawowe-poj\u0119cia",level:2},{value:"Tworzenie projektu",id:"tworzenie-projektu",level:2},{value:"Utw\xf3rzmy plik <code>server.ts</code>:",id:"utw\xf3rzmy-plik-serverts",level:3},{value:"Utw\xf3rzmy plik <code>client.ts</code>:",id:"utw\xf3rzmy-plik-clientts",level:3}];function a(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"gdy-serwer-rozmawia\u0142-klientem---prosta-aplikacja",children:"Gdy serwer rozmawia\u0142 klientem - prosta aplikacja"})}),"\n",(0,r.jsx)(n.h2,{id:"podstawowe-poj\u0119cia",children:"Podstawowe poj\u0119cia"}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{children:(0,r.jsx)(n.em,{children:"server"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Serwer to program (lub komputer), kt\xf3ry:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"czeka na po\u0142\u0105czenia i"}),"\n",(0,r.jsx)(n.li,{children:"odpowiada na pro\u015bby (\u017c\u0105dania) innych program\xf3w."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Serwer nie zaczyna rozmowy \u2014 tylko czeka, a\u017c kto\u015b si\u0119 z nim skontaktuje."}),"\n",(0,r.jsxs)(n.li,{children:["Kiedy klient wysy\u0142a zapytanie, serwer reaguje:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"przetwarza dane,"}),"\n",(0,r.jsx)(n.li,{children:"wysy\u0142a wynik,"}),"\n",(0,r.jsx)(n.li,{children:"zapisuje co\u015b w bazie"}),"\n",(0,r.jsx)(n.li,{children:"..."}),"\n"]}),"\n"]}),"\n"]}),(0,r.jsxs)(n.p,{children:["Serwer to ",(0,r.jsx)(n.strong,{children:"centrala telefoniczna"})," \u2013 siedzi i czeka na po\u0142\u0105czenia."]})]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{children:(0,r.jsx)(n.em,{children:"client"})}),(0,r.jsx)(n.p,{children:"Klient to program lub urz\u0105dzenie, kt\xf3re nawi\u0105zuje po\u0142\u0105czenie z serwerem:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"wysy\u0142a zapytania i"}),"\n",(0,r.jsx)(n.li,{children:"odbiera odpowiedzi."}),"\n"]}),(0,r.jsx)(n.p,{children:"W kontek\u015bcie socket\xf3w:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"klient inicjuje po\u0142\u0105czenie (dzwoni pierwszy),"}),"\n",(0,r.jsx)(n.li,{children:"zna adres IP i port serwera,"}),"\n",(0,r.jsx)(n.li,{children:"po po\u0142\u0105czeniu mo\u017ce wysy\u0142a\u0107 i odbiera\u0107 dane,"}),"\n",(0,r.jsx)(n.li,{children:"sam nie nas\u0142uchuje \u2014 to on prosi o kontakt."}),"\n"]}),(0,r.jsxs)(n.p,{children:["Klient to ",(0,r.jsx)(n.strong,{children:"osoba, kt\xf3ra wybiera numer i dzwoni"})," do centrali."]})]}),"\n",(0,r.jsx)(n.h2,{id:"tworzenie-projektu",children:"Tworzenie projektu"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["WebStorm,","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"New Project,"}),"\n",(0,r.jsx)(n.li,{children:"TypeScript"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["doinstalujemy paczki: ",(0,r.jsx)(n.code,{children:"npm install --save-dev ts-node @types/node"})]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"utw\xf3rzmy-plik-serverts",children:["Utw\xf3rzmy plik ",(0,r.jsx)(n.code,{children:"server.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import net from "net"\n\nconst server = net.createServer( socket => {\n    console.log("New connection")\n\n    socket.setEncoding("utf8")\n\n    socket.write("Witam na serwerze")\n\n    socket.on("data", data => {\n        console.log("Otrzymano do klienta: " + data.toString().trim())\n\n    })\n\n    socket.on("end", ()=>{\n        console.log("Klient od\u0142o\u017cy\u0142 s\u0142uchawk\u0119, koniec po\u0142\u0105czenia :( ")\n\n    })\n})\n\nserver.listen(1410, ()=>{\n    console.log("Serwer uruchomiony na porcie 1410")\n})\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Wyja\u015bnienia"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"createServer( socket => {...)"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'    const server = net.createServer((socket) => {\n    // Ten socket to "kana\u0142 komunikacyjny" z konkretnym klientem\n    // callback jest wywo\u0142ywany za ka\u017cdym razem, gdy nowy klient si\u0119 po\u0142\u0105czy\n    // Klient Hans \u0142\u0105czy si\u0119 z serwerem, powstaje obiekt socket1\n    // Klient M\u015bcib\xf3r \u0142\u0105czy si\u0119 z serwerem, powstaje obiekt socket2\n    // ...\n}\n});\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"socket.write('Cze\u015b\u0107 kliencie!')"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ta metoda wysy\u0142a dane z serwera do danego klienta"}),"\n",(0,r.jsxs)(n.li,{children:["dane s\u0105 wysy\u0142ane tylko do tego klient, z kt\xf3rego pochodzi ",(0,r.jsx)(n.code,{children:"socket"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:'socket.on("nazwaZdarzenia" ...)'}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["nas\u0142uchiwanie na zdarzenie ",(0,r.jsx)(n.code,{children:"nazwaZdarzenia"})]}),"\n",(0,r.jsx)(n.li,{children:'"Je\u015bli klient co\u015b przy\u015ble, to wykonana b\u0119dzie odpowiednia akcja"'}),"\n",(0,r.jsxs)(n.li,{children:["typ danych to ",(0,r.jsx)(n.code,{children:"Buffer"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.mdxAdmonitionTitle,{children:["Automatyczny ",(0,r.jsx)(n.code,{children:"emit"})]}),(0,r.jsxs)(n.p,{children:["W czystym ",(0,r.jsx)(n.code,{children:"EventEmitterze"})," w Node:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'emitter.on("co\u015b", handler)'})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'emitter.emit("co\u015b", dane)'})}),"\n"]}),(0,r.jsx)(n.p,{children:"Czyli:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"on(...)"})," nas\u0142uchuj\u0119 na zdarzenie"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"emit(...)"})," emituj\u0119 zdarzenie"]}),"\n"]}),(0,r.jsxs)(n.p,{children:["ALE: w przypadku ",(0,r.jsx)(n.code,{children:'socket.on("data", ...)'}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"nie emitujesz tego zdarzenia sam, robi to Node.js za Ciebie."}),"\n",(0,r.jsxs)(n.li,{children:["obiekt ",(0,r.jsx)(n.code,{children:"socket"})," (czy to po stronie serwera, czy klienta) jest:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"instancj\u0105 klasy `Socket, kt\xf3ra"}),"\n",(0,r.jsxs)(n.li,{children:["dziedziczy po ",(0,r.jsx)(n.code,{children:"EventEmitter"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Node wewn\u0119trznie:"}),"\n",(0,r.jsxs)(n.li,{children:["wywo\u0142uje ",(0,r.jsx)(n.code,{children:'.emit("data", ...)'})," za Ciebie, kiedy"]}),"\n",(0,r.jsx)(n.li,{children:"przychodz\u0105 dane po TCP."}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,r.jsxs)(n.h3,{id:"utw\xf3rzmy-plik-clientts",children:["Utw\xf3rzmy plik ",(0,r.jsx)(n.code,{children:"client.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import net from "net"\n\nconst client = net.createConnection({port: 1410}, () => {\n    console.log("Po\u0142\u0105czono z serwerem")\n})\n\nclient.setEncoding("utf8");\n\nclient.on("data", data => {\n    console.log(`Otrzymano z serwera ${data.toString().trim()}`)\n\n    client.write("Dzi\u0119ki, serwerze", ()=>{\n        console.log("Wiadomo\u015b\u0107 wys\u0142ana")\n        client.end()\n    })\n\n})\n\n\n\nclient.on("end", () => {\n    console.log("Roz\u0142\u0105czono z serwerem")\n})\n'})}),"\n",(0,r.jsxs)(n.p,{children:["::tip Jaka jest relacja mi\u0119dzy ",(0,r.jsx)(n.code,{children:"client.end()"})," a ",(0,r.jsx)(n.code,{children:'client.on("end", ()=> ...)'})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client.end()"}),", czyli ",(0,r.jsx)(n.code,{children:"client"}),' m\xf3wi do serwera: "Ko\u0144cz\u0119!"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"server"})," wykrywa zako\u0144czenie (np. w ",(0,r.jsx)(n.code,{children:'socket.on("end")'}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"server"})," zamyka swoje po\u0142\u0105czenie (np. ",(0,r.jsx)(n.code,{children:"socket.end()"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client"}),' odbiera "koniec danych" z serwera']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'client.on("end")'})," si\u0119 uruchamia"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:":::"})]})}function j(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>t});var s=i(6540);const r={},o=s.createContext(r);function c(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);