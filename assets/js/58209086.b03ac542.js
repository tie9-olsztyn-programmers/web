"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5063],{2997:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>j,frontMatter:()=>d,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"MongoDB/\u0141\u0105czenie","title":"Relacje w MongoDB - Operator $lookup","description":"Jak \u0142\u0105czy\u0107 dane z r\xf3\u017cnych kolekcji w potoku agregacji?","source":"@site/docs/4. MongoDB/70.\u0141\u0105czenie.mdx","sourceDirName":"4. MongoDB","slug":"/MongoDB/\u0141\u0105czenie","permalink":"/web/docs/MongoDB/\u0141\u0105czenie","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/4. MongoDB/70.\u0141\u0105czenie.mdx","tags":[],"version":"current","sidebarPosition":70,"frontMatter":{"title":"Relacje w MongoDB - Operator $lookup","sidebar_label":"Operator $lookup","description":"Jak \u0142\u0105czy\u0107 dane z r\xf3\u017cnych kolekcji w potoku agregacji?"},"sidebar":"tutorialSidebar","previous":{"title":"Agregacja","permalink":"/web/docs/MongoDB/Agregacja"},"next":{"title":"Projekt Liga E-sportowa","permalink":"/web/docs/MongoDB/Podsumowanie"}}');var o=i(4848),r=i(8453);const d={title:"Relacje w MongoDB - Operator $lookup",sidebar_label:"Operator $lookup",description:"Jak \u0142\u0105czy\u0107 dane z r\xf3\u017cnych kolekcji w potoku agregacji?"},l="\u0141\u0105czenie kolekcji: Operator $lookup",s={},t=[{value:"Metafora: Detektyw i Kartoteka",id:"metafora-detektyw-i-kartoteka",level:2},{value:"Sk\u0142adnia operatora",id:"sk\u0142adnia-operatora",level:2},{value:"Prosty przyk\u0142ad <em>Rok 1984</em>",id:"prosty-przyk\u0142ad-rok-1984",level:2},{value:"Kolekcja <em>authors</em>",id:"kolekcja-authors",level:3},{value:"Kolekcja <em>books</em>",id:"kolekcja-books",level:3},{value:"\u0141\u0105czenie",id:"\u0142\u0105czenie",level:3},{value:"Dodajemy dwie ksi\u0105\u017cki Orwella",id:"dodajemy-dwie-ksi\u0105\u017cki-orwella",level:3},{value:"Odwijamy <code>$unwind</code>",id:"odwijamy-unwind",level:2}];function c(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsxs)(n.h1,{id:"\u0142\u0105czenie-kolekcji-operator-lookup",children:["\u0141\u0105czenie kolekcji: Operator ",(0,o.jsx)(n.code,{children:"$lookup"})]})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"W \u015bwiecie baz danych rzadko zdarza si\u0119, aby wszystkie informacje znajdowa\u0142y si\u0119 w jednym miejscu."}),"\n",(0,o.jsx)(n.li,{children:'Czasem musimy "si\u0119gn\u0105\u0107" do innej kolekcji, aby pobra\u0107 dodatkowe dane.'}),"\n",(0,o.jsxs)(n.li,{children:["W MongoDB s\u0142u\u017cy do tego etap agregacji o nazwie ",(0,o.jsx)(n.code,{children:"$lookup"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"metafora-detektyw-i-kartoteka",children:"Metafora: Detektyw i Kartoteka"}),"\n",(0,o.jsx)(n.p,{children:"Wyobra\u017a sobie, \u017ce masz dwie teczki:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Teczka Zam\xf3wie\u0144"}),": Zawiera numer zam\xf3wienia i ",(0,o.jsx)(n.code,{children:"klient_id"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Teczka Klient\xf3w"}),": Zawiera szczeg\xf3\u0142y (imi\u0119, adres) przypisane do konkretnego ID."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Operator ",(0,o.jsx)(n.code,{children:"$lookup"})," dzia\u0142a jak detektyw, kt\xf3ry bierze ",(0,o.jsx)(n.code,{children:"klient_id"}),' z zam\xf3wienia,\nidzie do kartoteki klient\xf3w, znajduje pasuj\u0105c\u0105 osob\u0119\ni "dokleja" jej dane do Twojego zam\xf3wienia jako now\u0105 list\u0119.']}),"\n",(0,o.jsx)(n.h2,{id:"sk\u0142adnia-operatora",children:"Sk\u0142adnia operatora"}),"\n",(0,o.jsxs)(n.p,{children:["Oto jak wygl\u0105da podstawowa struktura ",(0,o.jsx)(n.code,{children:"$lookup"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'{\n  $lookup: {\n    from: "kolekcja_docelowa",       // Sk\u0105d bierzemy dane?\n    localField: "pole_u_nas",        // Jakie pole w obecnej kolekcji jest kluczem?\n    foreignField: "pole_u_nich",     // Jakie pole w tamtej kolekcji mu odpowiada?\n    as: "nazwa_wyniku"               // Pod jak\u0105 nazw\u0105 zapisa\u0107 po\u0142\u0105czone dane?\n  }\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{title:"Dlaczego wynik l\u0105duje w tablicy?",type:"tip",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["MongoDB zawsze zwraca wynik $lookup jako tablic\u0119 (",(0,o.jsx)(n.code,{children:"Array"}),"),","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"nawet je\u015bli znajdzie tylko jeden pasuj\u0105cy dokument."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Dlaczego?","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Bo system nie wie, czy relacja to 1:1 czy 1",":wiele","."]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,o.jsxs)(n.h2,{id:"prosty-przyk\u0142ad-rok-1984",children:["Prosty przyk\u0142ad ",(0,o.jsx)(n.em,{children:"Rok 1984"})]}),"\n",(0,o.jsxs)(n.h3,{id:"kolekcja-authors",children:["Kolekcja ",(0,o.jsx)(n.em,{children:"authors"})]}),"\n",(0,o.jsxs)(n.p,{children:["Zr\xf3by baz\u0119 danych ",(0,o.jsx)(n.em,{children:"library"})," z kolekcj\u0105 ",(0,o.jsx)(n.em,{children:"authors"})," i wprowad\u017amy dane:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'db.authors.insertOne({\n  _id: ObjectId("65a123abcde1234567890123"),\n  name: "George Orwell",\n  birth_year: 1903,\n  nationality: "British"\n})\n'})}),"\n",(0,o.jsxs)(n.h3,{id:"kolekcja-books",children:["Kolekcja ",(0,o.jsx)(n.em,{children:"books"})]}),"\n",(0,o.jsxs)(n.p,{children:["Zr\xf3by drug\u0105 kolekcj\u0119 w tej bazie ",(0,o.jsx)(n.em,{children:"books"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'db.books.insertOne({\n  title: "Rok 1984",\n  genre: "Dystopia",\n  published: 1949,\n  author_id: ObjectId("65a123abcde1234567890123") // To jest nasz "most"\n})\n\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u0142\u0105czenie",children:"\u0141\u0105czenie"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"db.books.aggregate([\n  {\n    $lookup: {\n      from: \"authors\",           // 1. Id\u017a do kolekcji 'authors'\n      localField: \"author_id\",    // 2. We\u017a 'author_id' z obecnej ksi\u0105\u017cki\n      foreignField: \"_id\",        // 3. Znajd\u017a dokument, kt\xf3ry ma takie '_id' w autorach\n      as: \"author_info\"           // 4. Wynik wrzu\u0107 do pola 'author_info'\n    }\n  }\n])\n"})}),"\n",(0,o.jsx)(n.p,{children:"wynik"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"{\n  _id: ObjectId('697a5cac659b9eaf0c1b6386'),\n  title: 'Rok 1984',\n  genre: 'Dystopia',\n  published: 1949,\n  author_id: ObjectId('65a123abcde1234567890123'),\n  author_info: [\n    {\n      _id: ObjectId('65a123abcde1234567890123'),\n      name: 'George Orwell',\n      birth_year: 1903,\n      nationality: 'British'\n    }\n  ]\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"dodajemy-dwie-ksi\u0105\u017cki-orwella",children:"Dodajemy dwie ksi\u0105\u017cki Orwella"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'[\n{\n    "title": "Folwark zwierz\u0119cy",\n    "original_title": "Animal Farm",\n    "genre": "Satyra polityczna",\n    "published": 1945,\n    "author_id": ObjectId("65a123abcde1234567890123")\n  },\n  {\n    "title": "Wiwat aspidistra",\n    "original_title": "Keep the Aspidistra Flying",\n    "genre": "Literatura pi\u0119kna",\n    "published": 1936,\n    "author_id": ObjectId("65a123abcde1234567890123")\n  }\n]\n'})}),"\n",(0,o.jsx)(n.p,{children:"ZAPYTANIE"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Wy\u015bwietl list\u0119 tytu\u0142\xf3w wraz z pe\u0142nymi profilami ich autor\xf3w."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'db.books.aggregate([\n  {\n    $lookup: {\n      from: "authors",\n      localField: "author_id",\n      foreignField: "_id",\n      as: "author_details"\n    }\n  }\n])\n'})}),"\n",(0,o.jsxs)(n.h2,{id:"odwijamy-unwind",children:["Odwijamy ",(0,o.jsx)(n.code,{children:"$unwind"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"$lookup"})," zawsze zwraca tablic\u0119 (wynik w nawiasach ",(0,o.jsx)(n.code,{children:"[...]"}),"),","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"nawet je\u015bli znajdzie tylko jednego autora."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["w u\u017cywaniu danych na frontendzi (React) to utrudnienie, bo:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["zamiast pisa\u0107 ",(0,o.jsx)(n.code,{children:"book.author.name"}),","]}),"\n",(0,o.jsxs)(n.li,{children:["musi pisa\u0107 ",(0,o.jsx)(n.code,{children:"book.author[0].name"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[":::waring ",(0,o.jsx)(n.code,{children:"$umwimd"}),"\n",(0,o.jsx)(n.code,{children:"$unwind"}),' s\u0142u\u017cy do "wyj\u0119cia" elementu z tablicy i sp\u0142aszczenia struktury dokumentu.']}),"\n",(0,o.jsxs)(n.admonition,{title:"Analogia - Pude\u0142ko w pude\u0142ku",type:"tip",children:[(0,o.jsx)(n.p,{children:"Wyobra\u017a sobie, \u017ce kupi\u0142e\u015b jedn\u0105 ksi\u0105\u017ck\u0119."}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Sprzedawca, zamiast poda\u0107 Ci j\u0105 do r\u0119ki, w\u0142o\u017cy\u0142 j\u0105 do wielkiego kartonu (tablicy)."}),"\n",(0,o.jsxs)(n.li,{children:["Bez ",(0,o.jsx)(n.code,{children:"$unwind"}),": Masz karton, w kt\xf3rym jest jedna ksi\u0105\u017cka. \u017beby j\u0105 przeczyta\u0107, musisz najpierw otworzy\u0107 karton."]}),"\n",(0,o.jsxs)(n.li,{children:["Z ",(0,o.jsx)(n.code,{children:"$unwind"}),": Rozrywasz karton i wyrzucasz go. Zostaje Ci sama ksi\u0105\u017cka w r\u0119ku."]}),"\n"]})]}),"\n",(0,o.jsx)(n.p,{children:"Przyk\u0142ad zapytania:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'db.books.aggregate([\n  {\n    $lookup: {\n      from: "authors",\n      localField: "author_id",\n      foreignField: "_id",\n      as: "author_details"\n    }\n  },\n  {\n    $unwind: "$author_details" // "Odwijamy" tablic\u0119\n  }\n])\n'})})]})}function j(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>l});var a=i(6540);const o={},r=a.createContext(o);function d(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);