"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[8979],{130:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"ExpressJS/Express/RetroGamesDB/DaneWJSON","title":"CRUD z JSON","description":"Na razie restart serwera przywraca\u0142 pierwotne dane,","source":"@site/docs/3. ExpressJS/50.Express/20.RetroGamesDB/95.DaneWJSON.mdx","sourceDirName":"3. ExpressJS/50.Express/20.RetroGamesDB","slug":"/ExpressJS/Express/RetroGamesDB/DaneWJSON","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/DaneWJSON","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3. ExpressJS/50.Express/20.RetroGamesDB/95.DaneWJSON.mdx","tags":[],"version":"current","sidebarPosition":95,"frontMatter":{"title":"CRUD z JSON"},"sidebar":"tutorialSidebar","previous":{"title":"Tworzymy `middleware`y","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/WlasneMiddleware"},"next":{"title":"Wzorzec CSR - *Controller-Service-Repository Pattern*","permalink":"/web/docs/ExpressJS/Express/RetroGamesDB/CSR"}}');var s=r(4848),t=r(8453);const o={title:"CRUD z JSON"},i="CRUD z JSON",d={},c=[{value:"Zamiana <code>gamesData.ts</code> na plik <code>gamesData.json</code>.",id:"zamiana-gamesdatats-na-plik-gamesdatajson",level:2},{value:"Definicja funkcji pomocniczych",id:"definicja-funkcji-pomocniczych",level:2},{value:"<code>GET</code> - refaktoryzacja kodu w <code>routes/games.ts</code>",id:"get---refaktoryzacja-kodu-w-routesgamests",level:2},{value:"Refactoryzacja <code>GET /games</code>",id:"refactoryzacja-get-games",level:3},{value:"Refactoryzacja <code>GET /games/3</code>",id:"refactoryzacja-get-games3",level:3},{value:"Refaktoryzacja <code>POST /games</code>",id:"refaktoryzacja-post-games",level:2},{value:"Refaktoryzacja <code>PUT</code> i <code>PATCH</code>",id:"refaktoryzacja-put-i-patch",level:2},{value:"Reafaktoryzacja <code>DELETE</code>",id:"reafaktoryzacja-delete",level:2}];function l(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"crud-z-json",children:"CRUD z JSON"})}),"\n",(0,s.jsxs)(n.p,{children:["Na razie restart serwera przywraca\u0142 pierwotne dane,\nbo wcale nie modyfikowali\u015bmy pliku ",(0,s.jsx)(n.code,{children:"gamesData.ts"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Teraz b\u0119dziemy modyfikowali plik ",(0,s.jsx)(n.code,{children:"gamesData.json"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"zamiana-gamesdatats-na-plik-gamesdatajson",children:["Zamiana ",(0,s.jsx)(n.code,{children:"gamesData.ts"})," na plik ",(0,s.jsx)(n.code,{children:"gamesData.json"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'[\n    { "id": 1, "title": "Super Mario Bros.", "year": 1985, "platform": "NES", "genre": "Platform" },\n    { "id": 2, "title": "Pong", "year": 1972, "platform": "Arcade", "genre": "Sport" },\n    { "id": 3, "title": "Boulder Dash", "year": 1984, "platform": "Atari 800XL", "genre": "Action" },\n    { "id": 4, "title": "River Raid", "year": 1982, "platform": "Atari 800XL", "genre": "Shooter" },\n    { "id": 5, "title": "Asteroids", "year": 1979, "platform": "Arcade", "genre": "Shooter" },\n    { "id": 6, "title": "Space Invaders", "year": 1978, "platform": "Arcade", "genre": "Shooter" },\n    { "id": 7, "title": "Sabre Wulf", "year": 1984, "platform": "ZX Spectrum", "genre": "Adventure" },\n    { "id": 8, "title": "Impossible Mission", "year": 1984, "platform": "Commodore 64", "genre": "Adventure" }\n]\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"definicja-funkcji-pomocniczych",children:"Definicja funkcji pomocniczych"}),"\n",(0,s.jsxs)(n.p,{children:["W naszym projekcie zastosujemy zasad\u0119 ",(0,s.jsx)(n.em,{children:"seperation of concerns"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["potrzebujemy modu\u0142\xf3w: ",(0,s.jsx)(n.code,{children:"fs"})," i ",(0,s.jsx)(n.code,{children:"path"}),","]}),"\n",(0,s.jsxs)(n.li,{children:["zdefiniujemy pomocnicze funkcje (",(0,s.jsx)(n.code,{children:"utils/fileUtiles.ts"}),"):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"readJSON"})," ,"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"writeJSON"}),","]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["utw\xf3rzymy nowy folder ",(0,s.jsx)(n.code,{children:"src/utlis"})]}),"\n",(0,s.jsxs)(n.li,{children:["wewn\u0105trz tego folderu utw\xf3rzymy plik ",(0,s.jsx)(n.code,{children:"fileUtils.ts"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import fs from "fs"\nimport path from "path"\n\n\nexport function readJSON(fileName: string): any[] {\n    const filePath = path.join(__dirname, "..", "data", fileName)\n    const data = fs.readFileSync(filePath, "utf-8");\n    return JSON.parse(data);\n}\n\nexport function writeJSON(fileName: string, data:any[]): void {\n    const filePath = path.join(__dirname, "..", "data", fileName)\n    fs.writeFileSync(filePath, JSON.stringify(data, null, 2), "utf-8");\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"get---refaktoryzacja-kodu-w-routesgamests",children:[(0,s.jsx)(n.code,{children:"GET"})," - refaktoryzacja kodu w ",(0,s.jsx)(n.code,{children:"routes/games.ts"})]}),"\n",(0,s.jsxs)(n.p,{children:["Zakomentujmy wszystkie ",(0,s.jsx)(n.code,{children:"route."})]}),"\n",(0,s.jsxs)(n.h3,{id:"refactoryzacja-get-games",children:["Refactoryzacja ",(0,s.jsx)(n.code,{children:"GET /games"})]}),"\n",(0,s.jsxs)(n.p,{children:["Plik ",(0,s.jsx)(n.code,{children:"routes/games.ts"})," bez cz\u0119\u015bci zakomentowanej, ale z nowym kodem:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import express, {Request, Response} from "express";\nimport{ readJSON, writeJSON } from "../utils/fileUtils";\n\nconst router = express.Router();\nconst fileName = "gamesData.json";\n\n\nrouter.get("/", (req: Request, res: Response) => {\n    const games = readJSON(fileName)\n    const {year, platform} = req.query;\n    console.log(year, platform)\n\n    if(!year && !platform) return res.json(games)\n\n    const filteredGames = games.filter(g => {\n        if (year && g.year > Number(year))  return false\n\n        if(platform){\n            if (typeof platform === "string"){\n                const queryPlatform = platform.toLowerCase();\n                const gamePlatform = g.platform.toLowerCase();\n                if(!gamePlatform.includes(queryPlatform)) return false;\n            }\n        }\n        return true\n    });\n    res.json(filteredGames);\n});\n\n//...\n\n\nexport default router;\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Sprawd\u017a, czy ",(0,s.jsx)(n.code,{children:"request"})," ",(0,s.jsx)(n.code,{children:"GET http://localhost:3000/games"})," zwr\xf3ci list\u0119 gier, bo powinien."]}),"\n",(0,s.jsxs)(n.h3,{id:"refactoryzacja-get-games3",children:["Refactoryzacja ",(0,s.jsx)(n.code,{children:"GET /games/3"})]}),"\n",(0,s.jsx)(n.p,{children:"Pod poprzedni\u0105 metod\u0105 dopisujemy:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'router.get("/:id", (req: Request, res: Response) => {\n    const games = readJSON(fileName)\n    const id = Number(req.params.id);\n    const game = games.find(g => g.id === Number(req.params.id));\n    if (!game) return res.status(404).json({ message: "Game not found" });\n    res.json(game);\n});\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"Sprawdzamy, \u017c\u0119 faktycznie dzia\u0142a."}),"\n",(0,s.jsxs)(n.h2,{id:"refaktoryzacja-post-games",children:["Refaktoryzacja ",(0,s.jsx)(n.code,{children:"POST /games"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'router.post("/", (req: Request, res: Response) => {\n    console.log(req.body) // w konsoli podgl\u0105damy warto\u015b\u0107 po dzia\u0142\u0105niu express.json()\n    try{\n        // POBIERAMY DANE Z "BAZY" json\n        const games: Game[] = readJSON(fileName);\n\n        const newGame: Game = {\n            id: Date.now(),\n            ...req.body\n        };\n\n        games.push(newGame); // dodajemy do naszej listy jakby bazy danych\n\n        // ZAPISUJEMY DANE W "BAZIE" json\n        writeJSON(fileName, games);\n\n        res.status(201).json(newGame); // zwracamy nowy obiekt z kodem 201\n    }catch(error){\n        if(error instanceof Error){\n            res.status(500).json({message: error.message});\n        }else{\n            console.error(error);\n        }\n    }\n})\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Sprawdzamy wbudowanym klientem, czy faktycznie nowy zas\xf3b zostanie zapisany do pliku ",(0,s.jsx)(n.code,{children:"gamesData.json"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"refaktoryzacja-put-i-patch",children:["Refaktoryzacja ",(0,s.jsx)(n.code,{children:"PUT"})," i ",(0,s.jsx)(n.code,{children:"PATCH"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'\nrouter.put("/:id", (req, res) => {\n    try {\n        const id = Number(req.params.id); // parsowanie id: string -> id: int\n        const games: Game[] = readJSON(fileName);\n\n        const index = games.findIndex(g => g.id === id); // zwraca index albo -1\n        if (index === -1) return res.status(404).json({message: "Game not found"});\n\n        games[index] = {id, ...req.body};\n        writeJSON(fileName, games);\n\n        res.json(games[index]);\n    } catch (error) {\n        console.error("Error updating the game", error); // Log do konsoli\n        res.status(500).json({ message: "Internal server error" }); // Odpowied\u017a dla klienta\n    }\n});\n\nrouter.patch("/:id", (req, res) => {\n    try{\n        const id = Number(req.params.id);\n        const games: Game[] = readJSON(fileName);\n        const game = games.find(g => g.id === id);\n        if (!game) return res.status(404).send("Game not found");\n\n        Object.assign(game, req.body); // aktualizacja tylko podanych p\xf3l\n        // ZAPIS DO "BAZY" json\n        writeJSON(fileName, games);\n\n        res.json(game);\n    }catch(error){\n        console.error(error)\n    }\n});\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"Sprawdzamy, czy dzia\u0142a."}),"\n",(0,s.jsxs)(n.h2,{id:"reafaktoryzacja-delete",children:["Reafaktoryzacja ",(0,s.jsx)(n.code,{children:"DELETE"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'\nrouter.delete("/:id", (req: Request, res: Response) => {\n    try {\n        const id = Number(req.params.id);\n        const games: Game[] = readJSON(fileName);\n\n        // Walidacja ID\n        if (isNaN(id) || id <= 0) {\n            return res.status(400).json({ message: "Invalid ID value \u2014 please provide a positive integer." });\n        }\n\n        const index = games.findIndex(g => g.id === id);\n        if (index === -1) {\n            return res.status(404).json({ message: "Game not found" });\n        }\n\n        // Usu\u0144 gr\u0119\n        const deletedGame = games.splice(index, 1)[0];\n        writeJSON(fileName, games);\n\n        res.json({\n            message: "Game deleted successfully!",\n            deleted: deletedGame\n        });\n    } catch (error) {\n        console.error("Error deleting the game: ", error);\n        res.status(500).json({ message: "Internal server error" });\n    }\n});\n'})})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var a=r(6540);const s={},t=a.createContext(s);function o(e){const n=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);